(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof module==='object'&&typeof module.exports==='object'){factory(require('jquery'));}else{factory(jQuery);}}(function($){$.timeago=function(timestamp){if(timestamp instanceof Date){return inWords(timestamp);}else if(typeof timestamp==="string"){return inWords($.timeago.parse(timestamp));}else if(typeof timestamp==="number"){return inWords(new Date(timestamp));}else{return inWords($.timeago.datetime(timestamp));}};var $t=$.timeago;$.extend($.timeago,{settings:{refreshMillis:60000,allowPast:true,allowFuture:false,localeTitle:false,cutoff:0,autoDispose:true,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:'any moment now',seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(distanceMillis){if(!this.settings.allowPast&&!this.settings.allowFuture){throw'timeago allowPast and allowFuture settings can not both be set to false.';}
var $l=this.settings.strings;var prefix=$l.prefixAgo;var suffix=$l.suffixAgo;if(this.settings.allowFuture){if(distanceMillis<0){prefix=$l.prefixFromNow;suffix=$l.suffixFromNow;}}
if(!this.settings.allowPast&&distanceMillis>=0){return this.settings.strings.inPast;}
var seconds=Math.abs(distanceMillis)/1000;var minutes=seconds/60;var hours=minutes/60;var days=hours/24;var years=days/365;function substitute(stringOrFunction,number){var string=$.isFunction(stringOrFunction)?stringOrFunction(number,distanceMillis):stringOrFunction;var value=($l.numbers&&$l.numbers[number])||number;return string.replace(/%d/i,value);}
var words=seconds<45&&substitute($l.seconds,Math.round(seconds))||seconds<90&&substitute($l.minute,1)||minutes<45&&substitute($l.minutes,Math.round(minutes))||minutes<90&&substitute($l.hour,1)||hours<24&&substitute($l.hours,Math.round(hours))||hours<42&&substitute($l.day,1)||days<30&&substitute($l.days,Math.round(days))||days<45&&substitute($l.month,1)||days<365&&substitute($l.months,Math.round(days/30))||years<1.5&&substitute($l.year,1)||substitute($l.years,Math.round(years));var separator=$l.wordSeparator||"";if($l.wordSeparator===undefined){separator=" ";}
return $.trim([prefix,words,suffix].join(separator));},parse:function(iso8601){var s=$.trim(iso8601);s=s.replace(/\.\d+/,"");s=s.replace(/-/,"/").replace(/-/,"/");s=s.replace(/T/," ").replace(/Z/," UTC");s=s.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");s=s.replace(/([\+\-]\d\d)$/," $100");return new Date(s);},datetime:function(elem){var iso8601=$t.isTime(elem)?$(elem).attr("datetime"):$(elem).attr("title");return $t.parse(iso8601);},isTime:function(elem){return $(elem).get(0).tagName.toLowerCase()==="time";}});var functions={init:function(){functions.dispose.call(this);var refresh_el=$.proxy(refresh,this);refresh_el();var $s=$t.settings;if($s.refreshMillis>0){this._timeagoInterval=setInterval(refresh_el,$s.refreshMillis);}},update:function(timestamp){var date=(timestamp instanceof Date)?timestamp:$t.parse(timestamp);$(this).data('timeago',{datetime:date});if($t.settings.localeTitle){$(this).attr("title",date.toLocaleString());}
refresh.apply(this);},updateFromDOM:function(){$(this).data('timeago',{datetime:$t.parse($t.isTime(this)?$(this).attr("datetime"):$(this).attr("title"))});refresh.apply(this);},dispose:function(){if(this._timeagoInterval){window.clearInterval(this._timeagoInterval);this._timeagoInterval=null;}}};$.fn.timeago=function(action,options){var fn=action?functions[action]:functions.init;if(!fn){throw new Error("Unknown function name '"+action+"' for timeago");}
this.each(function(){fn.call(this,options);$(this).addClass("loadedAgo");});return this;};function refresh(){var $s=$t.settings;if($s.autoDispose&&!$.contains(document.documentElement,this)){$(this).timeago("dispose");return this;}
var data=prepareData(this);if(!isNaN(data.datetime)){if($s.cutoff===0||Math.abs(distance(data.datetime))<$s.cutoff){$(this).text(inWords(data.datetime));}else{if($(this).attr('title').length>0){$(this).text($(this).attr('title'));}}}
return this;}
function prepareData(element){element=$(element);if(!element.data("timeago")){element.data("timeago",{datetime:$t.datetime(element)});var text=$.trim(element.text());if($t.settings.localeTitle){element.attr("title",element.data('timeago').datetime.toLocaleString());}else if(text.length>0&&!($t.isTime(element)&&element.attr("title"))){element.attr("title",text);}}
return element.data("timeago");}
function inWords(date){return $t.inWords(distance(date));}
function distance(date){return(new Date().getTime()-date.getTime());}
document.createElement("abbr");document.createElement("time");}));;var chatbox=chatbox||{};!function(t,e,i){"use strict";var a,r,n,o,s;chatbox=(a=/\bhttps?:\/\/\S+/gi,r=ips.getSetting("lazyLoadEnabled")?ips.getSetting("blankImg"):null,n={},o=function(t,e){return(Array(e=e||2).join("0")+t).slice(-e)},s=function(t,e,i){if(t.length<=e)return t;var a=e-(i=i||"...").length;return t.substr(0,Math.ceil(a/2))+i+t.substr(t.length-Math.floor(a/2))},{parseContent:function(e,i,n){var o=[],l=0;return e=e.replace(a,function(t){t=t.replace(/&amp;/g,"&");var a=e.indexOf(t,l),n=ips.templates.render("chatbox.parseURL",{url:t,text:s(t,60)});if("src='"!==e.substring(a,a-5)&&'srcset="'!==e.substring(a,a-8)){var c=t.substr(t.lastIndexOf(".")+1).toLowerCase();if(-1!=t.indexOf("/giphy.gif")||-1!==jQuery.inArray(c,["jpg","jpeg","jpe","png","gif","webp"])){if("twemoji"==ips.getSetting("emoji_style")&&-1!=t.indexOf("twemoji@"))n="<img class='chatboxEmoji' src='"+t+"'>";else if(i.allow_img){if(1!=ips.getSetting("bim_giphy_play")&&-1!=t.indexOf("/giphy.gif"))var g=t.split("/giphy.gif")[0]+"/giphy.gif",u=g.replace("/giphy.gif","/giphy_s.gif"),m=ips.templates.render("chatbox.parseGiphy",{gif:g,still:u,blankImage:r});else var m=ips.templates.render("chatbox.parseImage",{url:t,blankImage:r});o.push(m),n=""}}else if(-1!==jQuery.inArray(c,["mp3","wav"])){if(i.allow_audio){var h=t.indexOf("voice_memo.mp3")>-1;o.push(ips.templates.render("chatbox.parseAudio",{url:t,type:"wav"==c?"audio/wav":"audio/mpeg",isMemo:h})),n=""}}else if(-1!==jQuery.inArray(c,["mp4","ogg","webm"]))i.allow_video&&(o.push(ips.templates.render("chatbox.parseVideo",{source:"html5",play:t,blankImage:r,html5:!0})),n="");else if((t.indexOf("youtube.com")>=0||t.indexOf("youtu.be")>=0)&&i.allow_video){var p=t.split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/|\/shorts\/)/),d=void 0!==p[2]?p[2].split(/[^0-9a-z_\-]/i)[0]:p[0];o.push(ips.templates.render("chatbox.parseVideo",{source:"youtube",isShorts:t.indexOf("/shorts/")>0,url:t,play:"//www.youtube.com/embed/"+d+"?autoplay=1",id:d,img:"https://img.youtube.com/vi/"+d+"/mqdefault.jpg",blankImage:r,html5:!1})),n=""}}return l=a+t.length,n}),chatbox.emoji.getEmoji(function(t){for(var i in t)for(var a=0;a<t[i].length;a++)if("custom-"==t[i][a].code.substr(0,7))for(var r=ips.utils.escapeRegexp(t[i][a].name),n=RegExp("(^|\\s)"+(r=r.replace("<","&lt;").replace(">","&gt;"))+"(\\s|$)","gi");e.match(n);)e=e.replace(n,"$1"+chatbox.emoji.emojiImage(t[i][a].code,!0)+"$2")}),o.length>0&&(e+=" <div class='mediaItems'>",t.each(o,function(t,i){e+=i}),e+="</div>"),e},escapeHTML:function(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML},mention:function(e,i){var a=t(e.currentTarget).data("member");if(t(e.currentTarget).closest(".chatboxContainer").hasClass("chatboxConPopup"))var r=t(e.currentTarget).closest(".chatboxContainer").attr("data-conID"),n=t(".convo_"+r);else var r=t(e.currentTarget).closest(".chatboxContainer").attr("data-roomID"),n=t(e.currentTarget).closest(".room_"+r);if(i){if(n.find("#cke_chatMSG_"+r).is(":visible")){var o=CKEDITOR.instances["chatMSG_"+r],s=t(e.currentTarget).data("url"),l=t(e.currentTarget).data("ipshover-target"),c=t(e.currentTarget).data("id");if(parseInt(c)>0){var g=null;(g=new CKEDITOR.dom.element("span")).renameNode("a"),g.setAttribute("href",s),g.setAttribute("contenteditable","false"),g.setAttribute("data-ipsHover",""),g.setAttribute("data-ipsHover-target",l),g.setAttribute("data-mentionid",c),g.setHtml("@"+a),o.insertElement(g),o.insertHtml(" ")}else o.insertHtml("@"+a+" ")}}else{var u,m=n.find(".chatInput");u=m.val().length>0?m.val()+" @"+a:"@"+a,m.focus().val(u+" ")}},invertColor:function(t,e){0===t.indexOf("#")&&(t=t.slice(1));var i=t+"_"+e;if(n[i])return n[i];3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),t.length;var a=parseInt(t.slice(0,2),16),r=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16);if(e)return n[i]=.299*a+.587*r+.114*s>150?"202020":"FFFFFF",n[i];a=(255-a).toString(16),r=(255-r).toString(16),s=(255-s).toString(16);var l=o(a)+o(r)+o(s);return n[i]=l,n[i]},initCleanEditor:function(t){var e=t.find('[data-action="uploadIMG"]');if(e.length>0){var i=e.attr("class"),a=t.width()-(e.position().left+e.outerWidth());t.hasClass("inGlobalChat")&&(a-=2);var r=t.find(".ipsAttachment_dropZone");r.find('[data-action="uploadFile"]').addClass(i).removeClass("ipsButton_primary").html(e.html()),r.css({right:a,opacity:1}),e.css("visibility","hidden"),t.find(".ipsAttachment_fileList").insertAfter(r)}},isExternal:function(t){var e=t.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);return"string"==typeof e[1]&&!!(e[1].length>0)&&e[1].toLowerCase()!==location.protocol||"string"==typeof e[2]&&!!(e[2].length>0)&&e[2].replace(RegExp(":("+({"http:":80,"https:":443})[location.protocol]+")?$"),"")!==location.host},initTimeago:function(){1==ips.getSetting("chatbox_timeago")&&(t.timeago.settings.strings={prefixAgo:null,prefixFromNow:null,suffixAgo:"",suffixFromNow:"from now",seconds:ips.getString("chatbox_time_just_now"),minute:ips.getString("chatbox_time_1_minute"),minutes:ips.getString("chatbox_time_x_minutes"),hour:ips.getString("chatbox_time_1_hour"),hours:ips.getString("chatbox_time_x_hours"),day:ips.getString("chatbox_time_1_day"),days:ips.getString("chatbox_time_x_days"),month:ips.getString("chatbox_time_1_month"),months:ips.getString("chatbox_time_x_months"),year:ips.getString("chatbox_time_1_year"),years:ips.getString("chatbox_time_x_years"),wordSeparator:" ",numbers:[]})}}),String.prototype.startsWith=function(t){return 0===this.lastIndexOf(t,0)}}(jQuery,_);;!function(t,n,e){"use strict";ips.controller.register("bim.chatbox.startChat",{lmn1:!1,initialize:function(){this.on("click",'[data-action="startChat"]',this.startChat)},startChat:function(n){if(this.lmn1||0==t(".chatBar").length)return!1;this.lmn1=!0;var e=t(n.currentTarget).attr("data-memberID"),o=this;return ips.getAjax()(ips.getSetting("baseURL")+"index.php?app=chatbox&module=conversation&controller=main&do=openConversation",{data:{memberID:e},type:"post"}).done(function(n){if("error"==n.type)ips.ui.alert.show({message:n.message});else{var e=t(".convoTab_chats_content");if(e.find(".convoRow_"+n.conID).length>0)e.find(".convoRow_"+n.conID).click();else{var o=ips.templates.render("chatbox.newcon.temp",{id:n.conID});e.append(o),t(document).trigger("contentChange",[t("#convoIframe")]),e.find(".convoRow_"+n.conID).click()}e.find(".tempCon.convoRow_"+n.conID).remove()}}).always(function(t){o.lmn1=!1}),!1}})}(jQuery,_);;;(function($,_,undefined){"use strict";ips.controller.register('bim.chatbox.editor',{_updateEditor:null,_containerID:null,_container:null,_editorName:null,_useEnter:false,_editorHeight:0,_instanceReady:false,initialize:function(){this.setup();this.on('fileAdded',this.resizeBar);this.on('fileDeleted',this.resizeBar);this._updateEditor=setInterval(_.bind(this.updateEditor,this),500);},setup:function(){if(this.scope.hasClass('chatboxConPopup')){this._containerID=this.scope.attr('data-conID');this._container=$('.convo_'+this._containerID);this._editorName='chatCON_'+this._containerID;}
else{this._containerID=this.scope.attr('data-roomID');this._container=$('.room_'+this._containerID);this._editorName='chatMSG_'+this._containerID;}
this._useEnter=this.scope.attr('data-useEnter')==1?true:false;},updateEditor:function(){var self=this;var editor=null;try
{editor=CKEDITOR.instances[this._editorName];}
catch(err){return;}
if(editor){editor.on('instanceReady',function(){editor.setData('');ips.utils.db.remove('editorSave',editor.config.ipsAutoSaveKey);if(!self._instanceReady){self._instanceReady=true;}});editor.on('change',function(){if(self._editorHeight!=self._container.find('#cbCKEditor').height()){self.resizeBar();self._editorHeight=self._container.find('#cbCKEditor').height();}});if(self._useEnter){editor.on('key',function(ev){if(ev.data.keyCode==13){ev.cancel();self._container.find('#cbCKEditor').find('form').submit();}});}
if(self._instanceReady){if(self.scope.find('#cbCKEditor #cbDonateBtn')){var elDonate=self.scope.find('#cbCKEditor #cbDonateBtn').detach();self.scope.find('.cke_toolbar_end').prepend(elDonate);elDonate.show();}
clearInterval(self._updateEditor);}}},resizeBar:function(){$('.chatBar').trigger('resizeBar');},});}(jQuery,_));;;(function($,_,undefined){"use strict";ips.createModule('chatbox.emoji',function(){var _emoji=null,_categories=null,_ajax=null,_callbacks=[],getEmoji=function(callback){if(this._emoji&&this._categories){callback(this._emoji,this._categories);return;}
var baseURL=ips.getSetting('baseURL');var storage=ips.utils.db.get('chatboxEmoji',baseURL+'-'+ips.getSetting('emoji_cache'));var categories=ips.utils.db.get('chatboxEmojiCategories',baseURL+'-'+ips.getSetting('emoji_cache'));if(storage&&categories){this._emoji=storage;callback(storage,categories);}else{ips.utils.db.removeByType('chatboxEmoji');if(callback){if(!this._callbacks){this._callbacks=[];}
this._callbacks.push(callback);}
if(this._ajax&&this._ajax.abort){this._ajax.abort();}
this._ajax=ips.getAjax()(ips.getSetting('baseURL')+'index.php?app=chatbox&module=chatbox&controller=chatbox&do=emoji').done(function(emoji){this._emoji={};this._categories=[];for(var category in emoji){var categoryName=emoji[category].category;this._categories.push(categoryName);this._emoji[categoryName]=[];for(var i=0;i<emoji[category].emoji.length;i++){emoji[category].emoji[i].shortNames.push(ips.getString('emoji-'+emoji[category].emoji[i].name));this._emoji[categoryName].push(emoji[category].emoji[i]);}}
ips.utils.db.set('chatboxEmoji',ips.getSetting('baseURL')+'-'+ips.getSetting('emoji_cache'),this._emoji);ips.utils.db.set('chatboxEmojiCategories',ips.getSetting('baseURL')+'-'+ips.getSetting('emoji_cache'),this._categories);if(this._callbacks){for(var i=0;i<this._callbacks.length;i++){this._callbacks[i](this._emoji,this._categories);}}}.bind(this));}},emojiImage=function(codeToUse){var parts=codeToUse.split('-');if(_.isUndefined(this._emoji[parts[1]])){return null;}
for(var i=0;i<this._emoji[parts[1]].length;i++){if(this._emoji[parts[1]][i].code==codeToUse){var imgTag='<img src="'+this._emoji[parts[1]][i].image+'" loading="lazy"';imgTag+='title="'+this._emoji[parts[1]][i].name+'" alt="'+this._emoji[parts[1]][i].name+'"';if(this._emoji[parts[1]][i].image2x){imgTag+=' srcset="'+this._emoji[parts[1]][i].image2x+' 2x"';}
if(parseInt(this._emoji[parts[1]][i].width)&&parseInt(this._emoji[parts[1]][i].height)){imgTag+=' width="'+this._emoji[parts[1]][i].width+'" height="'+this._emoji[parts[1]][i].height+'"';}
imgTag+=' data-emoticon="true">';return imgTag;}}
return null;},preview=function(code){return this.emojiImage(code);};return{getEmoji:getEmoji,emojiImage:emojiImage,preview:preview,};});ips.controller.mixin('bim.chatbox.emoji','core.global.editor.emoticons',true,function(){if(ips.getSetting('chatbox_no_emoji')!=1){this.before('insertEmoji',function(e){var popup=$(e.currentTarget).closest('#chatboxEmoji_menu');if(popup.length>0){var name=popup.attr('data-btnID').split('_');if(name[0]=="room"||name[0]=="con"){var emo=null;var type=$(e.currentTarget).attr('data-emoji');if(type.indexOf('custom-')>=0){emo=$(e.currentTarget).find('img').attr('title');}
else{var ipsEmoji=$(e.currentTarget).find('.ipsEmoji');if(ipsEmoji.attr('src')&&ipsEmoji.attr('src')!=undefined){emo=ipsEmoji.attr('alt');}else{emo=$(e.currentTarget).find('.ipsEmoji').html();}}
var container=name[0]=="room"?$('.room_'+name[2]):$('.convo_'+name[2]);var inputEl=container.find('.chatInput');inputEl.val(inputEl.val()+" "+emo);ips.utils.emoji.logUse(type);}}});}});ips.controller.register('chatbox.emoticons',{initialize:function(){this.on('click','[data-emoji]',this.insertEmoji);this.on('menuItemSelected','[data-role="categoryTrigger"]',this.changeCategory);chatbox.emoji.getEmoji(function(emoji,categories){setTimeout(function(){this._buildEmoji(emoji,null,categories);}.bind(this),100);}.bind(this));},insertEmoji:function(e){var popup=$(e.currentTarget).closest('#chatboxEmoji_menu');var name=popup.attr('data-btnID').split('_');var container=name[0]=="room"?$('.room_'+name[2]):$('.convo_'+name[2]);var inputEl=container.find('.chatInput');inputEl.val(inputEl.val()+" "+$(e.currentTarget).find('img').attr('title'));ips.utils.emoji.logUse($(e.currentTarget).attr('data-emoji'));},_buildEmoji:function(emoji,search,categories){var finalHtml='';var categoryHtml='';var pos=0;var emojiForThisRow='';var menuContent=[];if(!search&&ips.utils.cookie.get('recentEmoji')){var recentlyUsed=ips.utils.cookie.get('recentEmoji').split(',');var newRecentlyUsed=[];if(recentlyUsed.length){for(var i=0;i<recentlyUsed.length;i++){var displayHtml=chatbox.emoji.preview(recentlyUsed[i]);if(displayHtml){newRecentlyUsed.push(recentlyUsed[i]);emojiForThisRow+=ips.templates.render('core.editor.emoji',{display:displayHtml,name:null,code:recentlyUsed[i]});if(newRecentlyUsed.length==8||newRecentlyUsed.length==16){categoryHtml+=ips.templates.render('core.editor.emoticonRow',{emoticons:emojiForThisRow});emojiForThisRow='';}}}
if(emojiForThisRow){categoryHtml+=ips.templates.render('core.editor.emoticonRow',{emoticons:emojiForThisRow});}
if(categoryHtml){finalHtml+=ips.templates.render('core.editor.emoticonCategory',{title:ips.getString('emoji-category-recent'),categoryID:category,emoticons:categoryHtml});categoryHtml='';emojiForThisRow='';}}
if(newRecentlyUsed!=recentlyUsed){ips.utils.cookie.set('recentEmoji',newRecentlyUsed.join(','),true);}}
for(var i in categories){var category=categories[i];var categoryCount=0;for(var i=0;i<emoji[category].length;i++){var codeToUse=emoji[category][i].code;emojiForThisRow+=ips.templates.render('core.editor.emoji',{display:chatbox.emoji.preview(codeToUse),name:ips.haveString('emoji-'+emoji[category][i].name)?ips.getString('emoji-'+emoji[category][i].name):emoji[category][i].name,code:codeToUse});pos++;categoryCount++;if(pos==8){categoryHtml+=ips.templates.render('core.editor.emoticonRow',{emoticons:emojiForThisRow});pos=0;emojiForThisRow='';}}
if(!search){if(pos){categoryHtml+=ips.templates.render('core.editor.emoticonRow',{emoticons:emojiForThisRow});}
if(categoryHtml){var categoryTitle=emoji[category][0].categoryName;finalHtml+=ips.templates.render('core.editor.emoticonCategory',{title:categoryTitle,categoryID:category,emoticons:categoryHtml});categoryHtml='';pos=0;emojiForThisRow='';menuContent.push(ips.templates.render('core.editor.emoticonMenu',{title:categoryTitle,count:categoryCount,categoryID:category}));}}}
$(this.scope).find('[data-role="categoryTrigger"]').show();$(this.scope).find('[data-role="categoryMenu"]').html(menuContent.join(''));this.scope.find('.ipsMenu_innerContent').html(finalHtml);var replaceEmojiInCategory=function(category){var emoji=category.querySelectorAll('img[data-src]');_.each(emoji,function(img){img.setAttribute('src',img.getAttribute('data-src'));img.addEventListener('load',emojiLoaded);});};var emojiLoaded=function(e){e.target.removeAttribute('data-loading');};this.scope.find('.ipsMenu_innerContent .ipsEmoticons_category').each(function(){ips.utils.lazyLoad.observe(this,{preloadCallback:$.noop,imgLoadedCallback:$.noop,loadedCallback:$.noop,loadCallback:function(category){replaceEmojiInCategory(category);var nextCategory=$(this).next('.ipsEmoticons_category');if(nextCategory.length){replaceEmojiInCategory(nextCategory.get(0));}}},{rootMargin:'350px'});});},changeCategory:function(e,data){this.scope.find('.ipsMenu_innerContent').scrollTop(this.scope.find('.ipsMenu_innerContent').scrollTop()+this.scope.find('[data-categoryid="'+data.selectedItemID+'"]').position().top-85);}});}(jQuery,_));;;(function($,_,undefined){"use strict";ips.controller.register('bim.chatbox.ignoredUsers',{initialize:function(){this.on('click','[data-action="delUser"]',this.delUser);this.on('submit','form',this.addnew);this.scope.click();},addnew:function(e){e.preventDefault();var self=this;var form=$(e.currentTarget);ips.getAjax()(form.attr('action'),{data:form.serialize(),type:'post',bypassRedirect:true}).done(function(response){if(response.type=='error'){ips.ui.alert.show({message:response.message});}
else{self.scope.find('.cToken_close').click();var container=self.scope.find('[data-role="tableRows"]');if(container.length==0){var newCon="<div data-role='tableRows'></div>";self.scope.find('[data-resort="listResort"]').html(newCon);}
self.scope.find('[data-role="tableRows"]').prepend(response.html);}});return false;},delUser:function(e){var self=this;ips.getAjax()($(e.currentTarget).attr('href')).done(function(response){if(response.type=='error'){ips.ui.alert.show({message:response.message});}
else{$(e.currentTarget).closest('.cbIgRow').remove();}});return false;},});}(jQuery,_));;!function(t,e,n){"use strict";ips.controller.register("bim.chatbox.main",{lmn1:null,lmn2:null,lmn3:null,lmn4:null,lmn5:"",lmn6:null,lmn7:null,lmn8:null,lmn9:null,lmn10:null,lmn11:null,lmn12:!0,lmn13:!1,lmn14:!1,lmn15:!1,lmn16:!1,lmn17:!1,lmn18:0,lmn19:0,lmn20:0,lmn21:0,lmn22:0,lmn23:{},lmn24:null,lmn25:!0,lmn26:[],initialize:function(){this.scope.find(".convoList").length>0&&(this.setup(),this.on("focus","#searchMem",this.focusSearchMem),this.on("blur","#searchMem",this.blurSearchMem),this.on("click",'[data-action="closeSearch"]',this.closeSearch),this.on("click",'[data-action="openConversation"]',this.openConversation),this.on("click",'[data-action="openRoom"]',this.openRoom),this.on("click",'[data-action="createGroup"]',this.createGroup),this.on("change",'select[data-action="changeStyle"]',this.selectChangeStyle),this.on("menuItemSelected",".conOptions",this.conOptions),this.on("menuItemSelected",".msgAction",this.msgAction),this.on("click",'.convoList [data-action="toggleChat"], .convoTab [data-action="toggleChat"]',this.toggleChat),this.on("click",'[data-action="closeChat"]',this.closeChat),this.on("click",'[data-action="msgOptions"]',function(t){return chatbox.toggleControlMSG(t),!1}),this.on("click",".convoTab .chat_row",function(t){chatbox.hideAllControlMSG(t)}),this.on("click",'.convoTab [data-action="mention"]',this.mention),this.lmn6.autoload?this.scope.find(".convoTab #chatContentIframe").on("scroll",e.bind(this.autoLoad,this)):this.on("click",'.convoTab [data-action="loadMore"]',this.loadMore),this.on("click",'[data-action="convoTabChange"]',this.convoTabChange),this.on("focus",".convoTab .chatInput",this.readTab),this.on("submit",".convoTab .chatboxEditor",this.submitEditor),this.lmn6.use_editor||(this.on("click",'.convoTab [data-action="sendMSG"]',this.clickSubmit),this.on("keypress",".convoTab #chatInputArea textarea",this.enterSubmit)),this.on("click",'[data-action="refresh"]',this.refresh)),this.resizeBar(),this.on(window,"resize",this.resizeBar),this.scope.bind("resizeBar",this.resizeBar),t(".mbBottomPlayer").length&&t(".mbBottomPlayer").is(":visible")&&this.scope.closest(".chatBar").css({bottom:"60px"}),chatbox.initTimeago(),this.scope.css("visibility","visible")},setup:function(){var e=this;if(e.lmn1=ips.getSetting("baseURL")+"index.php?app=chatbox&module=conversation&controller=main",e.lmn2="chatbox_tabs_"+ips.getSetting("memberID"),e.lmn3="chatbox_con_off_"+ips.getSetting("memberID"),e.lmn6=ips.getSetting("chatbox_conversations"),e._blankImage=ips.getSetting("lazyLoadEnabled")?ips.getSetting("blankImg"):null,e.lmn8=e.lmn6.soundfile?e.lmn6.soundfile:ips.getSetting("baseURL")+"applications/core/interface/sounds/notification.mp3",ips.loader.get(["core/interface/howler/howler.core.min.js"]).then(function(){e._sound=new Howl({src:e.lmn8,autoplay:!1})}),e.lmn9=e.scope.find("#convoContent .convoResults"),e.lmn10=e.scope.find("#convoContent .searchResults"),ips.getSetting("chatbox_bar_mini")&&t.each(ips.getSetting("chatbox_bar_mini").split(","),function(t,n){if(ips.utils.responsive.currentIs(n.toLowerCase()))return e.lmn25=!1,!1}),e.lmn25){var n=this.getMiniTabs();e.scope.find(".convoTab").each(function(e){var o=t(this).find(".chatboxContainer").attr("data-conID");t(this).hasClass("minimize")&&0>n.indexOf("c_"+o)&&t(this).removeClass("minimize")})}e.updateChat()},syncTabs:function(){var e=this,n=[];e.scope.find(".convoTab").each(function(o){if(!t(this).hasClass("minimize")){var a="convo_"+t(this).find(".chatboxContainer").attr("data-conID");if(void 0===e.lmn23[a]&&(e.lmn23[a]={lastID:0,firstLoad:1,canLoadMore:1,loadingMore:0}),"asc"==e.lmn6.sort)var i=e.lmn23[a].lastID>0?e.lmn23[a].lastID:t("."+a).find(".chat_row").last().attr("id");else var i=e.lmn23[a].lastID>0?e.lmn23[a].lastID:t("."+a).find(".chat_row").first().attr("id");e.lmn23[a].lastID=i>0?i:0,n.push(a)}}),t.each(e.lmn23,function(o,a){-1===t.inArray(o,n)&&delete e.lmn23[o]})},readTab:function(e){var n=t(e.currentTarget).closest(".chatboxContainer").attr("data-conID");this.updateFocusTabs(n)},updateFocusTabs:function(e){var n=t(".convo_"+e),o=parseInt(n.find(".mainTitle").find(".newMsgCount").text());o=isNaN(o)?0:o;var a=0!=this.lmn19?this.lmn19.split(","):[];if(0>a.indexOf(e)&&a.unshift(e),a.length>0&&(this.lmn19=a.join(",")),o>0&&n.find(".mainTitle").find(".newMsgCount").is(":visible")){n.find(".mainTitle").find(".newMsgCount").hide().text(),n.find(".miniTitle").find(".newMsgCount").hide().text(),t('.convoTab_chats_content .convoRow[data-conid="'+e+'"]').find(".newMsgCountTxt").hide().text(),t('.convoTab_chats_content .convoRow[data-conid="'+e+'"]').removeClass("mentionMe");var i=parseInt(t(".convoList .popupTitle").find(".newMsgCount").text());(i=isNaN(i)?0:i-o)>0?t(".convoList").find(".newMsgCount").show().text(i):t(".convoList").find(".newMsgCount").hide().text(),this.lmn15&&(i>0?n.find(".totalMsgCount").show().text(i):n.find(".totalMsgCount").hide().text())}},refresh:function(){return this.updateChat(!0),!1},updateChat:function(t){var e=this;if(e.lmn16&&!e.lmn12)return!1;!0==t&&(e.lmn13=!1,clearTimeout(e.lmn7));var n=e.lmn6.interval>=5e3?e.lmn6.interval:5e3;e.doUpdateChat(function(){e.lmn7=setTimeout(function(){e.updateChat(!0)},n)})},doUpdateChat:function(e){var n=this;if(n.lmn13)return!1;n.lmn13=!0;var o=!0;return n.syncTabs(),this.lmn24=ips.getAjax()(n.lmn1+"&do=updateChat",{type:"POST",dataType:"json",data:{tabData:JSON.stringify(n.lmn23),roomsLastUpdate:n.lmn21,conLastMsgID:n.lmn18,activeTab:n.lmn22,focusTabs:n.lmn19,firstLoad:n.lmn12?1:0}}).done(function(a){if("error"==a.type)ips.ui.alert.show({message:a.message});else{if(a.ping&&(a.ping.rooms&&(t(".convoTab_rooms_content").html(n.myConvoRoomsHTML(a.ping.rooms)),t(document).trigger("contentChange",[t(".convoTab_rooms_content")]),n.lmn21=a.ping.rooms[0].lastUpdate,a.ping.rooms[0].totalRooms>0?t("#convoTab_rooms").show():t("#convoTab_rooms").hide()),a.ping.chats&&(n.lmn6.no_counter_popup&&t.each(a.ping.chats,function(e,i){t(".convo_"+i.id).length>0&&!t(".convo_"+i.id).hasClass("minimize")&&parseInt(i.unread)>0&&(a.ping.chats[e].unread="0",n.updateFocusTabs(i.id),o=!1)}),t(".convoTab_chats_content").html(n.myConvoChatsHTML(a.ping.chats)),t(".convoList").hasClass("minimize")||t(".convoTab_chats_content").width(t(".convoList").width()),t(document).trigger("contentChange",[t(".convoTab_chats_content")]),t(".timeago:not(.loadedAgo)").timeago(),n.lmn18=a.ping.chats[0].lastMsgID),t(".chatBar").find(".ipsOnlineStatus_online:not(.cbMemOnline)").hide(),a.ping.online&&t.each(a.ping.online,function(e,n){t(".convo_"+n).length>0&&t(".convo_"+n).find(".ipsOnlineStatus_online").show(),t(".convoRow_"+n).find(".ipsOnlineStatus_online").show()}),n.notify(a.ping.chats)),a.tabs&&t.each(a.tabs,function(e,o){if(void 0!==n.lmn23["convo_"+e]){var a=t(".convo_"+e).find("#chatContentIframe"),i=t(".convo_"+e).find("#chatContent");if(n.lmn23["convo_"+e].lastID!=o.lastID&&o.messages){if(i.find(".noMsg").remove(),"asc"==n.lmn6.sort){if(a.scrollTop()+a.innerHeight()-a.prop("scrollHeight")>=-30)var s=1;i.append(n.chatRowHTML(o.messages,e)),n.lmn23["convo_"+e].firstLoad&&!n.lmn6.autoload&&o.messages.length==n.lmn6.limit&&i.prepend(ips.templates.render("chatbox.loadMoreBtn")),t(document).trigger("contentChange",[a]),(1==s||n._forceScrollDown)&&n.goDown(e)}else i.prepend(n.chatRowHTML(o.messages,e)),n.lmn23["convo_"+e].firstLoad&&!n.lmn6.autoload&&o.messages.length==n.lmn6.limit&&i.append(ips.templates.render("chatbox.loadMoreBtn")),t(document).trigger("contentChange",[a]);t(".timeago:not(.loadedAgo)").timeago(),ips.utils.cookie.get("chatbox_is_silent")||1==ips.utils.cookie.get("chatbox_con_nosound_"+e)||1==n.lmn23["convo_"+e].firstLoad||n.lmn17||n._sound.play(),i.find("img").imagesLoaded(function(t){n.lmn23["convo_"+e].firstLoad=0}),n.lmn23["convo_"+e].lastID=o.lastID}else i.find(".noMsg").show();n.lmn25&&t(".convo_"+e).find(".ipsLoading").removeClass("ipsLoading")}}),n.lmn22>0){var i=t(".convo_"+n.lmn22).find(".noMsg");i.length>0&&i.is(":hidden")&&n.updateChat(!0),t(".convo_"+n.lmn22).find(".ipsLoading").removeClass("ipsLoading"),chatbox.initCleanEditor(t(".convo_"+n.lmn22))}a.changes&&t.each(a.changes,function(e,o){o?t("#"+e+" .chatbox_msg").html(n.parseContent(o)):t("#"+e).remove()})}"function"==typeof e&&e()}).fail(function(){}).always(function(t){n.lmn12=!1,n._forceScrollDown=!1,n.lmn13=!1,n.lmn22=0,n.lmn25=!1,o&&(n.lmn19=0)}),!1},notify:function(e){if(e){var n=this,o=0,a=0!=n.lmn19?n.lmn19.split(","):[];if(n.lmn12){var i={};t.each(e,function(t,e){parseInt(e.unread)>0&&(i[e.id+""]=e.unread)}),n.lmn20=i}if(t.each(e,function(e,i){if(!(a.indexOf(i.id)>=0)){if(parseInt(i.unread)>0){if(o+=parseInt(i.unread),t(".convo_"+i.id).find(".newMsgCount").show().text(i.unread),t('.convoTab_chats_content [data-conid="'+i.id+'"]').find(".newMsgCountTxt").show().text("("+i.unread+")"),!n.lmn12){if(t.inArray(i.id,n.lmn26)>=0)return;if(n.lmn20&&void 0!==n.lmn20[i.id]){if(i.unread<=n.lmn20[i.id])return;n.lmn20[i.id]=i.unread}if(ips.utils.cookie.get("chatbox_is_silent")||1==ips.utils.cookie.get("chatbox_con_nosound_"+i.id)||n.lmn17||n._sound.play(),n.lmn15){var s=ips.templates.render("chatbox.newcon.notify",{id:i.id,title:i.title,icon:i.icon,lastMsg:i.lastMsg,inDay:i.inDay,time:i.lastMsgTime});t("#elFlashMessage").is(":visible")&&t("#elFlashMessage").find('[data-role="newNotification"]').length?t("#elFlashMessage").find('[data-role="newNotification"]').replaceWith(s):ips.ui.flashMsg.show(s,{timeout:5,position:"top",sticky:!1,extraClasses:"chatboxflashMsg ipsPadding:half",escape:!1})}else t(".chatBar").find(".convo_"+i.id).length<=0&&t('.convoTab_chats_content [data-conid="'+i.id+'"]').click()}}else t(".convo_"+i.id).find(".newMsgCount").hide().text(),t('.convoTab_chats_content [data-conid="'+i.id+'"]').find(".newMsgCountTxt").hide().text()}}),o>0?t(".convoList").find(".newMsgCount").show().text(o):t(".convoList").find(".newMsgCount").hide().text(),n.lmn15){var s=parseInt(t(".convoList .mainTitle").find(".newMsgCount").text());s>0?t(".convoTab").find(".totalMsgCount").show().text(s):t(".convoTab").find(".totalMsgCount").hide().text()}}},openConversation:function(n){var o=this,a=t(n.currentTarget).attr("data-conID"),i=t(n.currentTarget).attr("data-memberID");if(a>0)var s=t(".chatBar").find(".convo_"+a);else var r=t(n.currentTarget).find("strong").text(),s=t(".chatBar").find('.mainTitle .conNames[title="'+r+'"]').closest(".bimChatbox");if(s.length>0)return s.hasClass("minimize")?s.find('.popupTitle[data-action="toggleChat"]').click():s.fadeOut(80).fadeIn(80).find(".chatInput").focus(),!1;var c=ips.templates.render("chatbox.blankCon",{conID:a});"left"==ips.getSetting("chatbox_bar_pos")?t(".chatBar").append(c):t(".chatBar").prepend(c);var l=t(".chatBar").find(".convo_"+a);return ips.getAjax()(o.lmn1+"&do=openConversation",{data:{memberID:i,conID:a},type:"post"}).done(function(a){if("error"==a.type)ips.ui.alert.show({message:a.message}),l.remove();else{l.replaceWith(a.html);var i=t(".chatBar").find(".convo_"+a.conID);i.removeClass("minimize"),t(document).trigger("contentChange",[i]);var s=o.getMyPopups();if(0>s.indexOf("c_"+a.conID)&&(s.unshift("c_"+a.conID),o.saveMyPopups(s.join("|"))),t(n.currentTarget).find(".newMsgCountTxt").text()){var r=parseInt(t(n.currentTarget).find(".newMsgCountTxt").text().replace(/^\D+/g,""));i.find(".newMsgCount").text(r),o.updateFocusTabs(a.conID)}o.lmn22=a.conID,o.updateChat(!0),o.closeOldPopups(),t(n.currentTarget).removeClass("mentionMe"),o.scope.find(".convo_"+a.conID+" #chatContentIframe").on("scroll",e.bind(o.autoLoad,o)),o.resizeBar(),(ips.utils.responsive.currentIs("tablet")||ips.utils.responsive.currentIs("phone"))&&t(".chatBar").css("width","100%")}}),!1},createGroup:function(e){var n=ips.ui.dialog.create({url:this.lmn1+"&do=createGroup",size:"narrow",title:ips.getString("chatbox_create_group_title"),forceReload:!0,destructOnClose:!0,callback:function(e){t(e).find("form").on("submit",function(e){return e.preventDefault(),ips.getAjax()(t(e.currentTarget).attr("action"),{data:t(e.currentTarget).serialize(),type:"post",bypassRedirect:!0}).done(function(e){if("error"==e.type)ips.ui.alert.show({message:e.message});else{n.hide();var o=t(".convoTab_chats_content");if(o.find(".convoRow_"+e.conID).length>0)o.find(".convoRow_"+e.conID).click();else{var a=ips.templates.render("chatbox.newcon.temp",{id:e.conID});o.append(a),t(document).trigger("contentChange",[t("#convoIframe")]),o.find(".convoRow_"+e.conID).click()}o.find(".tempCon.convoRow_"+e.conID).remove()}}),!1})}});return n.show(),!1},configGroup:function(e,n){n.originalEvent.preventDefault();var o=t(e.target).closest(".chatboxContainer").attr("data-conID"),a=t(".convo_"+o);return!(a.find(".cbConfigGroupForm").length>0)&&(ips.getAjax()(this.lmn1+"&do=configGroup",{type:"post",data:{conID:o}}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):(a.find("#conOptions"+o+"_menu").hide(),a.find("#convoWrapper").prepend(e),t(document).trigger("contentChange",[a]),a.find(".cbConfigGroupForm").on("submit",function(e){return e.preventDefault(),ips.getAjax()(t(e.currentTarget).attr("action"),{data:t(e.currentTarget).serialize(),type:"post",bypassRedirect:!0}).done(function(n){"error"==n.type?ips.ui.alert.show({message:n.message}):(t(e.currentTarget).closest("form").remove(),ips.ui.flashMsg.show(ips.getString("chatbox_group_saved")))}),!1}),a.find(".cbConfigGroupForm .formCancel").on("click",function(e){return t(e.currentTarget).closest("form").remove(),!1}))}),!1)},inviteGroup:function(e,n){n.originalEvent.preventDefault();var o=this,a=t(e.target).closest(".chatboxContainer").attr("data-conID"),i=t(".convo_"+a);return!(i.find(".cbInviteGroupForm").length>0)&&(ips.getAjax()(o.lmn1+"&do=inviteGroup",{type:"post",data:{conID:a}}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):(i.find("#conOptions"+a+"_menu").hide(),i.find("#convoWrapper").prepend(e),t(document).trigger("contentChange",[i]),i.find(".cbInviteGroupForm").on("submit",function(e){return e.preventDefault(),ips.getAjax()(t(e.currentTarget).attr("action"),{data:t(e.currentTarget).serialize(),type:"post",bypassRedirect:!0}).done(function(n){"error"==n.type?ips.ui.alert.show({message:n.message}):(t(e.currentTarget).closest("form").remove(),o.lmn17=!0,o.lmn22=a,o.updateChat(!0),o.lmn6.lastchat=t.now())}),!1}),i.find(".cbInviteGroupForm .formCancel").on("click",function(e){return t(e.currentTarget).closest("form").remove(),!1}))}),!1)},renameGroup:function(e,n){n.originalEvent.preventDefault();var o=this,a=t(e.target).closest(".chatboxContainer").attr("data-conID"),i=t(".convo_"+a);return!(i.find(".cbRenameGroupForm").length>0)&&(ips.getAjax()(o.lmn1+"&do=renameGroup",{type:"post",data:{conID:a}}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):(i.find("#conOptions"+a+"_menu").hide(),i.find("#convoWrapper").prepend(e),t(document).trigger("contentChange",[i]),i.find(".cbRenameGroupForm").on("submit",function(e){return e.preventDefault(),ips.getAjax()(t(e.currentTarget).attr("action"),{data:t(e.currentTarget).serialize(),type:"post",bypassRedirect:!0}).done(function(n){"error"==n.type?ips.ui.alert.show({message:n.message}):(t(e.currentTarget).closest("form").remove(),o.updateConName(a,n.newName),o.lmn17=!0,o.lmn22=a,o.updateChat(!0),o.lmn6.lastchat=t.now())}),!1}),i.find(".cbRenameGroupForm .formCancel").on("click",function(e){return t(e.currentTarget).closest("form").remove(),!1}))}),!1)},updateConName:function(e,n){var o=t(".convo_"+e);if(n&&n!=o.find(".conNames").text()){o.find(".conNames").attr("title",n),o.find(".conNames").text(n);var a=t(".convoList .convoRow_"+e+" .conRowName");a.attr("title",n),a.find("b").text(n)}},leaveGroup:function(e,n){n.originalEvent.preventDefault();var o=this,a=t(e.target).closest(".chatboxContainer").attr("data-conID");return ips.ui.alert.show({type:"confirm",message:ips.getString("chatbox_leave_con_cfr"),icon:"warn",buttons:{ok:ips.getString("chatbox_confirm_yes"),cancel:ips.getString("chatbox_confirm_cancel")},callbacks:{ok:function(){ips.getAjax()(o.lmn1+"&do=leaveGroup",{type:"post",data:{conID:a}}).done(function(t){"error"==t.type?ips.ui.alert.show({message:t.message}):(o.closeConversation(a),o.resizeBar(),ips.ui.flashMsg.show(ips.getString("chatbox_you_left_group")))})}}}),!1},usersInGroup:function(e,n){n.originalEvent.preventDefault();var o=t(e.target).closest(".chatboxContainer").attr("data-conID");return t(".convo_"+o),ips.ui.dialog.create({url:this.lmn1+"&do=usersInGroup&conID="+o,title:ips.getString("chatbox_group_member"),size:"narrow",forceReload:!0,destructOnClose:!0,destructOnClose:!0,callback:function(t){}}).show(),!1},loadMore:function(e){var n=this,o=t(e.currentTarget).closest("#chatContentIframe"),a=o.find("#chatContent"),i=o.closest(".chatboxContainer").attr("data-conID");if(0==t(".convo_"+i).length||void 0===n.lmn23["convo_"+i]||1==n.lmn23["convo_"+i].loadingMore)return!1;n.lmn23["convo_"+i].loadingMore=1;var s="asc"==n.lmn6.sort?a.children(".chat_row:first").attr("id"):a.children(".chat_row:last").attr("id");return ips.getAjax()(n.lmn1+"&do=updateOpenTabs",{type:"post",dataType:"json",data:{tabData:JSON.stringify(n.lmn23),activeTab:i,loadMoreMode:s}}).done(function(r){if("error"==r.type)ips.ui.alert.show({message:r.message});else if(r.tabs[i]){if(1==r.tabs[i].noMore)t(e.currentTarget).remove(),ips.ui.flashMsg.show(ips.getString("chatbox_no_older"));else{var c=r.tabs[i].messages;c&&("asc"==n.lmn6.sort?(t(e.currentTarget).after(n.chatRowHTML(c,i)),o.scrollTop(a.find("#"+s).position().top-50)):t(e.currentTarget).before(n.chatRowHTML(c,i)),t(document).trigger("contentChange",[o]),t(".timeago:not(.loadedAgo)").timeago())}}}).always(function(){n.lmn23["convo_"+i].loadingMore=0}),!1},autoLoad:function(e){if(!this.lmn6.autoload)return!1;var n=this,o=t(e.currentTarget),a=o.find("#chatContent"),i=o.closest(".chatboxContainer").attr("data-conID");if(0==t(".convo_"+i).length||void 0===n.lmn23["convo_"+i]||1==n.lmn23["convo_"+i].firstLoad||1!=n.lmn23["convo_"+i].canLoadMore)return!1;if("asc"==this.lmn6.sort){if(0!=o.scrollTop())return!1;var s=a.children().first().attr("id")}else{if(o.scrollTop()+o.innerHeight()<o[0].scrollHeight)return!1;var s=a.children().last().attr("id")}if(o.find("#loadMore").length<=0){var r=ips.templates.render("chatbox.loadMore");"asc"==this.lmn6.sort?a.prepend(r):a.append(r)}n.lmn23["convo_"+i].canLoadMore=0,n.lmn23["convo_"+i].loadingMore=1,ips.getAjax()(n.lmn1+"&do=updateOpenTabs",{type:"post",dataType:"json",data:{tabData:JSON.stringify(n.lmn23),activeTab:i,loadMoreMode:s}}).done(function(e){if("error"==e.type)ips.ui.alert.show({message:e.message});else if(e.tabs[i]){if(1==e.tabs[i].noMore)ips.ui.flashMsg.show(ips.getString("chatbox_no_older"));else{var r=e.tabs[i].messages;r&&("asc"==n.lmn6.sort?(a.prepend(n.chatRowHTML(r,i)),o.scrollTop(a.find("#"+s).position().top-50)):a.append(n.chatRowHTML(r,i)),t(document).trigger("contentChange",[o]),t(".timeago:not(.loadedAgo)").timeago(),n.lmn23["convo_"+i].canLoadMore=1)}}o.find("#loadMore").remove()}).always(function(){n.lmn23["convo_"+i].loadingMore=0})},msgAction:function(e,n){(e=n?n.originalEvent:e).preventDefault();var o=t(e.target).attr("data-action"),a=t(e.target).attr("data-chatID");if(o)switch(o){case"edit":this.editEditor(a);break;case"delete":this.deleteMSG(a);break;case"report":this.reportMSG(a)}return!1},deleteMSG:function(t){var e=this;return ips.ui.alert.show({type:"confirm",message:ips.getString("chatbox_confirmDelete"),icon:"warn",buttons:{ok:ips.getString("chatbox_confirm_yes"),cancel:ips.getString("chatbox_confirm_cancel")},callbacks:{ok:function(){ips.getAjax()(e.lmn1+"&do=deleteMSG",{type:"post",data:{chatID:t}}).done(function(n){"error"==n.type?ips.ui.alert.show({message:n.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_deleted")),e.scope.find("li#"+t).remove())})}}}),!1},reportMSG:function(e){var n=this.scope.find("li#"+e).closest(".chatboxContainer").attr("data-conID"),o=ips.ui.dialog.create({url:ips.getSetting("baseURL")+"index.php?app=chatbox&module=conversation&controller=conversation&do=reportComment&id="+n+"&comment="+e,size:"medium",title:ips.getString("chatbox_report"),forceReload:!1,destructOnClose:!0,callback:function(e){t(e).find("form").on("submit",function(e){for(var n in e.preventDefault(),CKEDITOR.instances)CKEDITOR.instances[n].updateElement();var a=t(e.currentTarget);return ips.getAjax()(a.attr("action"),{data:a.serialize(),type:"post",bypassRedirect:!0}).done(function(t){ips.ui.flashMsg.show(ips.getString("chatbox_sent_report"))}).always(function(t){o.hide()}),!1})}});return o.show(),!1},toggleInputForm:function(e,n){var o=t(".convo_"+e),a=o.find(".chatInput"),i=o.find('[data-action="sendMSG"]');1==n?(this.lmn14=!1,i.prop("disabled",!1),a.val(""),a.closest("#chatInputArea").hasClass("expanded")&&(a.closest("#chatInputArea").removeClass("expanded"),a.css("height","auto"),t(".chatBar").trigger("resizeBar"))):(this.lmn14=!0,i.prop("disabled",!0))},getMyPopups:function(){return ips.utils.cookie.get(this.lmn2)?ips.utils.cookie.get(this.lmn2).split("|"):[]},saveMyPopups:function(t){ips.utils.cookie.set(this.lmn2,t)},getMiniTabs:function(){return ips.utils.cookie.get(this.lmn3)?ips.utils.cookie.get(this.lmn3).split("|"):[]},saveMiniTabs:function(t){ips.utils.cookie.set(this.lmn3,t)},myConvoRoomsHTML:function(e){var n="chatbox"==t("body").data("pageapp")&&"room"==t("body").data("pagecontroller"),o="";return t.each(e,function(e,a){if(n&&a.id==t("body").data("pageid")){t(".room_"+a.id).find('[data-action="closeChat"]').click();return}o+=ips.templates.render("chatbox.convo.list.rooms",{id:a.id,title:a.title,icon:a.icon,users:a.users})}),o},myConvoChatsHTML:function(e){var n="",o=this;return t.each(e,function(e,a){if((a.lastMsg||a.isGroup)&&(n+=ips.templates.render("chatbox.newcon.chats",{id:a.id,title:a.title,name:a.name,icon:a.icon,isOnline:a.isOnline,lastMsg:a.lastMsg.replace("&#44;",", "),inDay:a.inDay,lastMsgTime:a.lastMsgTime,unread:a.unread>0?a.unread:null,isGroup:a.isGroup}),a.isGroup&&o.updateConName(a.id,a.name)),t(".convo_"+a.id).length>0){var i=t(".convo_"+a.id).find(".ipsOnlineStatus_online");!a.isOnline&&i.is(":visible")?i.hide():a.isOnline&&i.is(":hidden")&&i.show()}}),n},convoTabChange:function(e){var n=t(e.currentTarget).attr("id");return t(e.currentTarget).closest(".convoTabs").find("a").removeClass("isActive"),t(e.currentTarget).addClass("isActive"),t(".cvtabContent").hide(),t("."+n+"_content").show(),!1},closeOldPopups:function(){!this.lmn15&&t(window).width()<330*t(".chatBar .inGlobalChat").length-1&&("left"==ips.getSetting("chatbox_bar_pos")?t(".chatBar .inGlobalChat:first").next().find('[data-action="closeChat"]').click():t(".chatBar .inGlobalChat:last").prev().find('[data-action="closeChat"]').click())},focusSearchMem:function(){this.lmn4=setInterval(e.bind(this.checkSearching,this),700)},blurSearchMem:function(){clearInterval(this.lmn4)},closeSearch:function(){return this.lmn5=null,t(".closeSearchBtn").hide(),this.lmn10.hide(),this.lmn9.show(),this.scope.find("#searchMem").val(""),!1},checkSearching:function(){var e=this.scope.find("#searchMem").val();if(e.length<3||e==this.lmn5){e||this.closeSearch();return}this.lmn5=e,t(".closeSearchBtn").show(),this.lmn11&&this.lmn11.abort&&this.lmn11.abort();var n=this;return this.lmn11=ips.getAjax()(n.lmn1+"&do=findMember",{data:{input:n.lmn5},type:"post"}).done(function(e){if(e.length){var o="";t.each(e,function(t,e){o+=ips.templates.render("chatbox.newcon.mem",{value:n.lmn5,id:e.id,photo:e.photo,isOnline:e.isOnline,name:e.name,extra:e.extra,conID:e.conID,isBan:e.isBan})}),n.lmn10.html(o).show(),n.lmn9.hide()}}),!1},openRoom:function(e){var n=this,o=t(e.currentTarget).attr("data-roomID"),a=t(".chatBar").find(".room_"+o);if(a.length>0){a.hasClass("minimize")?a.find('.popupTitle[data-action="toggleChat"]').click():a.fadeOut(80).fadeIn(80).find(".chatInput").focus();return}var i=ips.templates.render("chatbox.blankRoom",{roomID:o});"left"==ips.getSetting("chatbox_bar_pos")?t(".chatBar").append(i):t(".chatBar").prepend(i);var s=t(".chatBar").find(".room_"+o);return ips.getAjax()(n.lmn1+"&do=openRoom",{type:"post",data:{room:o}}).done(function(e){if("error"==e.type)ips.ui.alert.show({message:e.message}),s.remove();else{s.replaceWith(e.html),ips.setSetting("chatbox_"+o,e.config);var a=t(".chatBar").find(".room_"+o);a.removeClass("minimize"),t(document).trigger("contentChange",[a]),a.find(".chatInput")&&a.find(".chatInput").focus();var i=n.getMyPopups();0>i.indexOf("r_"+o)&&(i.unshift("r_"+o),n.saveMyPopups(i.join("|"))),n.closeOldPopups(),n.resizeBar()}}),!1},chatRowHTML:function(e,n){var o=this,a="",i="",s="",r="chatbox.style."+this.updateStyle(n),c=ips.getSetting("chatbox_userFormat"),l="";return t.each(e,function(t,e){e.chatterID>0?(i=(s=ips.getSetting("baseURL")+"index.php?app=core&module=members&controller=profile&id="+e.chatterID)+"&do=hovercard",l=c[e.chatterGroup].prefix+e.chatterName+c[e.chatterGroup].suffix,a+=ips.templates.render(r,{id:e.id,chatterID:e.chatterID,chatterName:e.chatterName,chatterKey:e.chatterKey,chatterNameFormat:l,chatterPhoto:e.chatterPhoto,chatterUrl:s,memberHovercard:i,content:o.parseContent(e.content),callme:-1!=e.content.indexOf("@"+ips.getSetting("chatbox_member_name")),isMe:e.chatterName==ips.getSetting("chatbox_member_name"),inDay:e.inDay,time:e.time,canEdit:e.canEdit,canDelete:e.canDelete,canReport:e.chatterName!=ips.getSetting("chatbox_member_name")&&e.canReport,canManageMSG:e.canEdit||e.canDelete})):a+=ips.templates.render("chatbox.style.con.system",{id:e.id,content:e.content,inDay:e.inDay,time:e.time,canDelete:e.canDelete})}),a},parseContent:function(t){return this.lmn6.use_editor?t:chatbox.parseContent(t,this.lmn6)},enterSubmit:function(e){if(13===e.which)return t(e.currentTarget).closest(".chatboxEditor").submit(),!1},clickSubmit:function(e){return console.log("aaaa"),t(e.currentTarget).closest("#chatInputArea").find("form").submit(),!1},submitEditor:function(e){e.preventDefault();var n=this;if(n.lmn14)return!1;var o=t(e.currentTarget).closest(".chatboxConPopup").attr("data-conID"),a=t(".convo_"+o),i=a.find(".chatboxEditor");if(this.lmn6.use_editor)var s=CKEDITOR.instances["chatCON_"+o],r=s.getData();else{var r=i.find("textarea").val();r=chatbox.escapeHTML(r)}return(0!=n.scope.find(".chatboxEditor .ipsAttach_done").length&&!r||0!=n.checkMSG(r))&&0!=n.checkFlood()&&(s?i.find('button[type="submit"]').prop("disabled",!0).text(ips.getString("chatbox_posting")):n.toggleInputForm(o,0),n.lmn14=!0,ips.getAjax()(i.attr("action"),{data:i.serialize(),type:"post",bypassRedirect:!0}).done(function(e){"error"==e.type?(ips.ui.alert.show({message:e.message}),n.lmn14=!1):"deletedCon"==e.type?(ips.ui.alert.show({message:e.message}),n.closeConversation(e.conID)):(n.lmn17=!0,n.lmn22=o,n.updateChat(!0),n.lmn6.lastchat=t.now(),t(".chatBar").trigger("resizeBar"))}).always(function(){n.lmn14=!1,n._forceScrollDown=!0,n.lmn23["convo_"+o].loadingMore=0,s?(ips.ui.editor.getObj(a.find('[data-role="chatboxFormArea"] [data-ipsEditor]')).reset(),i.find('button[type="submit"]').prop("disabled",!1).text(ips.getString("chatbox_send"))):(n.toggleInputForm(o,1),a.find(".charCount").hide(),n.scope.find('#chatInputArea [data-role="deleteFile"]').length>0&&n.scope.find('#chatInputArea [data-role="deleteFile"]').each(function(){t(this).click()}))}),!1)},editEditor:function(e){var n=this,o=n.scope.find("li#"+e).closest(".chatboxContainer"),a=o.attr("data-conID"),i=ips.ui.dialog.create({url:n.lmn1+"&do=editEditor&chatID="+e,size:n.lmn6.use_editor?"normal":"narrow",title:ips.getString("chatbox_edit"),forceReload:!0,destructOnClose:!0,callback:function(){if(n.lmn6.use_editor)var s=t(".ipsDialog_content .cbEditorEdit").find("form");else{var s=t(".ipsDialog_content .cbCleanTextEdit");s.find("textarea").on("keypress",function(t){if(13===t.which)return s.submit(),!1})}s.on("submit",function(s){if(s.preventDefault(),n.lmn6.use_editor){var r=CKEDITOR.instances["chatCON_"+a+"_"+e];r.updateElement();var c=r.getData()}else{var c=t(this).find("textarea").val();c=chatbox.escapeHTML(c)}if((0==t(s.currentTarget).find(".ipsAttach_done").length||c)&&0==n.checkMSG(c))return!1;var l=t(s.currentTarget).serializeArray();return l.push({name:"newMsg",value:c}),ips.getAjax()(t(s.currentTarget).attr("action"),{data:l,type:"post",bypassRedirect:!0}).done(function(a){"error"==a.type?ips.ui.alert.show({message:a.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_edited")),o.find("#chatRow_"+e+" .chatbox_msg").html(n.parseContent(a.content)),t(document).trigger("contentChange",[o]))}).always(function(t){i.hide()}),!1})}});return i.show(),!1},checkFlood:function(){if(this.lmn6.flood>0&&1!=this.lmn6.canManage&&!this.lmn6.canBypassFlood){var e=(t.now()-this.lmn6.lastchat)/1e3;if(e<this.lmn6.flood)return ips.ui.alert.show({message:ips.getString("chatbox_error_flood",{time:(this.lmn6.flood-e).toFixed(2)})}),0}return 1},checkMSG:function(t){var t=t.trim(),e=this.lmn6.length;return t.length<=0?(ips.ui.alert.show({message:ips.getString("chatbox_error_empty")}),0):e>0&&t.length>e?(ips.ui.alert.show({message:ips.pluralize(ips.getString("chatbox_error_maxlength"),e)}),0):1},conOptions:function(e,n){switch((e=n?n.originalEvent:e).preventDefault(),t(e.target).attr("data-action")){case"toggleSound":this.toggleSound(e,n);break;case"closeAllTabs":this.closeAllTabs(e,n);break;case"miniAllTabs":this.miniAllTabs(e,n);break;case"silentMode":this.silentMode(e,n);break;case"delCon":this.delCon(e,n);break;case"configGroup":this.configGroup(e,n);break;case"inviteGroup":this.inviteGroup(e,n);break;case"renameGroup":this.renameGroup(e,n);break;case"leaveGroup":this.leaveGroup(e,n);break;case"usersInGroup":this.usersInGroup(e,n);break;case"changeSkin":this.changeSkin(e,n);break;case"changeStyle":this.changeStyle(e,n)}},toggleSound:function(e,n){n.originalEvent.preventDefault();var o=t(e.target).closest(".chatboxContainer").attr("data-conID"),a=ips.utils.cookie.get("chatbox_con_nosound_"+o);t(e.target).find(".fa").replaceWith(t("<i/>").addClass("fa").addClass(1!=a?"fa-volume-off":"fa-volume-up").removeClass(1!=a?"fa-volume-up":"fa-volume-off")),ips.utils.cookie.set("chatbox_con_nosound_"+o,1==a?0:1)},closeAllTabs:function(e,n){return n.originalEvent.preventDefault(),t(".chatBar").find(".inGlobalChat").each(function(e){t(this).find('.miniTitle [data-action="closeChat"]').click()}),!1},miniAllTabs:function(e,n){return n.originalEvent.preventDefault(),t(".chatBar").find(".inGlobalChat").each(function(e){t(this).hasClass("minimize")||t(this).find('.mainTitle [data-action="toggleChat"]').click()}),!1},silentMode:function(e,n){n.originalEvent.preventDefault();var o="",a=ips.utils.cookie.get("chatbox_is_silent");return t(e.target).find(".cbToggleIcon").addClass(1==a?"fa-toggle-off":"fa-toggle-on").removeClass(1==a?"fa-toggle-on":"fa-toggle-off"),ips.utils.cookie.set("chatbox_is_silent",1==a?0:1),1==ips.utils.cookie.get("chatbox_is_silent")?(o=ips.getString("chatbox_on_silent"),t('[data-action="toggleSound"]').closest("li").hide()):(o=ips.getString("chatbox_off_silent"),t('[data-action="toggleSound"]').closest("li").show()),ips.ui.flashMsg.show(o),!1},delCon:function(e,n){n.originalEvent.preventDefault();var o=this,a=t(e.target).closest(".chatboxContainer").attr("data-conID");return ips.ui.alert.show({type:"confirm",message:ips.getString("chatbox_del_con_cfr"),icon:"warn",buttons:{ok:ips.getString("chatbox_confirm_yes"),cancel:ips.getString("chatbox_confirm_cancel")},callbacks:{ok:function(){ips.getAjax()(o.lmn1+"&do=delCon",{type:"post",data:{conID:a}}).done(function(t){"error"==t.type?ips.ui.alert.show({message:t.message}):(o.closeConversation(a),o.resizeBar())})}}}),!1},changeSkin:function(e,n){n.originalEvent.preventDefault();var o=t(e.target).data("skin"),a=t(e.target).closest(".chatboxContainer").attr("data-conID");return t(e.target).closest(".chatboxSkins").find("li").removeClass("skinSelected"),t(e.target).addClass("skinSelected"),t(e.target).closest(".bimChatbox").removeClass(function(t,e){return(e.match(/(^|\s)skin_\S+/g)||[]).join(" ")}),t(e.target).closest(".bimChatbox").addClass("skin_"+o),a>0?ips.utils.cookie.set("chatbox_con_skin_"+a,o):ips.utils.cookie.set("chatbox_maincon_skin",o),!1},changeStyle:function(e,n){n.originalEvent.preventDefault();var o=this,a=t(e.target).closest(".chatboxContainer").attr("data-conID");return t(e.target).one("change",function(){return o.applyNewStyle(a,this.value),!1}),!1},applyNewStyle(e,n){ips.utils.cookie.get("chatbox_con_style_"+e)!=n&&(ips.utils.cookie.set("chatbox_con_style_"+e,n),t(".convo_"+e).find("#chatContent").empty(),this.lmn23["convo_"+e].lastID=0,this.lmn19=e,this.lmn22=e,this.updateChat(!0))},updateStyle:function(t){return 1==this.lmn6.allow_select_skins&&ips.utils.cookie.get("chatbox_con_style_"+t)?ips.utils.cookie.get("chatbox_con_style_"+t):this.lmn6.style?this.lmn6.style:"standard"},selectChangeStyle:function(e){var n=t(e.currentTarget).closest(".chatboxContainer").attr("data-conID"),o=t(e.currentTarget).find(":selected").val();return this.applyNewStyle(n,o),!1},mention:function(t){return t.preventDefault(),chatbox.mention(t,this.lmn6.use_editor),!1},resizeBar:function(){if(t(".chatBar").find(".convoList").length>0){if(ips.utils.responsive.currentIs("tablet")||ips.utils.responsive.currentIs("phone")){t(".chatBar").addClass("chatBoxMessenger"),this.lmn15=!0;var e=t(".chatBar").find(".openFromBar").length;0==e?t(".chatBar").find(".convoList").show():1==e?t(".chatBar").find(".convoList").hide():e>1&&t(".chatBar").find(".openFromBar").each(function(e){t(this).find('[data-action="closeChat"]').click()})}else t(".chatBar").find(".convoList").show(),t(".chatBar").removeClass("chatBoxMessenger"),this.lmn15=!1}var n=1==ips.getSetting("chatbox_bar_full")&&ips.utils.responsive.currentIs("phone")?t(window).height():ips.getSetting("chatbox_popup_height");return t(".mbBottomPlayer").length&&t(".mbBottomPlayer").is(":visible")&&(n-=60),t(".chatBar .inGlobalChat").each(function(){if(!t(this).hasClass("minimize")){var e=n<=t(window).height()?n:t(window).height(),o=t(this).find(".cbScroll");if(1!=ips.getSetting("chatbox_force_scroll_down"))var a=o.scrollTop()+o.innerHeight()-o.prop("scrollHeight")>=-30;else var a=!0;e<=t(this).height()?o.height(o.height()-(t(this).height()-e)):o.height(n-(t(this).height()-o.height())),t(this).height()>t(window).height()&&o.height(o.height()-(t(this).height()-t(window).height())),a&&o.hasClass("asc")&&o.scrollTop(o.prop("scrollHeight"))}}),t(".cbLastMSG").width(t(".convoList").width()-63),!1},toggleChat:function(e){e.preventDefault();var n=t(e.currentTarget).closest(".bimChatbox"),o=n.hasClass("convoTab")?n.find(".chatboxContainer").attr("data-conID"):0,a=this.getMiniTabs();if(n.hasClass("minimize")){if(t(e.currentTarget).find(".unknown").length>0)return n.find('[data-action="closeChat"]').click(),!1;n.removeClass("minimize"),n.hasClass("convoTab")&&(this.updateFocusTabs(o),this.lmn22=o,this.updateChat(!0)),this.resizeBar(),this.lmn15&&t(".chatBar").css({width:"100%"}),a.splice(t.inArray("c_"+o,a),1)}else n.addClass("minimize"),this.lmn15&&t(".chatBar").css({width:"auto"}),0>a.indexOf("c_"+o)&&a.unshift("c_"+o);return this.saveMiniTabs(a.join("|")),!1},closeChat:function(e){var n=this.getMyPopups(),o=this.getMiniTabs(),a=t(e.currentTarget).closest(".chatboxContainer");if(a.closest(".bimChatbox").hasClass("minimize"),a.hasClass("chatboxConPopup")){var i=a.attr("data-conID"),s="c_"+i;delete this.lmn23["convo_"+i]}else var i=a.attr("data-roomID"),s="r_"+i;return n.splice(t.inArray(s,n),1),this.saveMyPopups(n.join("|")),o.splice(t.inArray(s,o),1),this.saveMiniTabs(o.join("|")),t(e.currentTarget).closest(".bimChatbox").remove(),this.lmn15&&t(".convoList").hasClass("minimize")?t(".convoList").find('.miniTitle[data-action="toggleChat"]').click():this.resizeBar(),0>t.inArray(i,this.lmn26)&&this.lmn26.push(i),!1},closeConversation:function(e){t(".convo_"+e).find('[data-action="closeChat"]').click(),t(".convoTab_chats_content").find('[data-conid="'+e+'"]').remove()},goDown:function(e){var n=t(".convo_"+e).find("#chatContentIframe");t(".convo_"+e).find("#chatContent");var o=0!=this.lmn23["convo_"+e].loadingMore;o||n.scrollTop(n.prop("scrollHeight")),this._blankImage||n.find("img").imagesLoaded(function(t){o||n.scrollTop(n.prop("scrollHeight"))})}})}(jQuery,_);;!function(t,e,i){"use strict";ips.controller.register("bim.chatbox.media",{lmn1:null,lmn2:null,lmn3:null,lmn4:"",lmn5:0,initialize:function(){this.scope.find("#chatInputArea textarea").length>0?(this.on("click",'[data-action="emoji"]',this.emoji),this.on("click",'[data-action="bimGiphy"]',this.bimGiphy),this.on("focus","#chatInputArea textarea",this.focusChatInput),this.on("blur","#chatInputArea textarea",this.blurChatInput),this.on("input","#chatInputArea textarea",this.autoGrowTextarea),t("body").find("#chatboxEmoji_menu").length||t("body").append(ips.templates.render(1==ips.getSetting("chatbox_no_emoji")?"chatbox.emoticons":"core.editor.emoticons",{id:"chatboxEmoji",editor:"chatboxEditor"})),ips.utils.db.get("chatboxEmoji",ips.getSetting("baseURL")+"-"+ips.getSetting("emoji_cache"))||chatbox.emoji.getEmoji()):this.on("click",".ipsAttachLink_image",this.lightboxIMG),this.on("click",'[data-action="zoomImage"]',this.zoomImage),this.on("click",'[data-action="playVideoInPopup"]',this.playVideoInPopup),this.on("click",'[data-action="playVideoInIframe"]',this.playVideoInIframe),this.on("fileAdded",this.fileAdded),this.on("fileDeleted",this.deletedFile),"roomChat"==this.scope.closest(".bimChatbox").attr("id")?(this.lmn1=this.scope.attr("data-roomID"),this.lmn2=ips.getSetting("chatbox_"+this.lmn1)):(this.lmn1=this.scope.attr("data-conID"),this.lmn2=ips.getSetting("chatbox_conversations"));var e=this.scope.find("#chatInputArea textarea");e.val(""),this.lmn2.autogrow||e.css("white-space","pre")},lightboxIMG:function(e){if(void 0===t(e.currentTarget).data("ipslightbox"))return t(e.currentTarget).attr("data-ipslightbox",""),t(document).trigger("contentChange",[t(e.currentTarget)]),t(e.currentTarget).click(),!1},autoGrowTextarea:function(e){var i=t(e.currentTarget),a=this.lmn2.length;if(a>0){var o=i.val().length,s=this.scope.find(".charCount");s.text(o+"/"+a),0==o?s.hide():(s.show(),o<=a?s.hasClass("isOver")&&s.removeClass("isOver"):s.hasClass("isOver")||s.addClass("isOver"))}if(this.lmn2.autogrow){var n=i.closest(".bimChatbox"),h=n.height(),r=i.closest("#chatInputArea"),c=i.height(),l=!1;if(i.css("height","auto").css("height",i[0].scrollHeight+"px"),r.hasClass("expanded")?0==i.val().length&&0==i.find(".ipsAttach").length&&(r.removeClass("expanded"),l=!0):c<i.height()&&(r.addClass("expanded"),l=!0),l||c==i.height()||(l=!0),l){if(r.hasClass("sort_asc")){var d=n.find("#chatContentIframe");if(d.scrollTop()+d.innerHeight()-d.prop("scrollHeight")>=-30)var p=!0}if(i.closest(".inGlobalChat").length>0)t(".chatBar").trigger("resizeBar");else{var g=n.find(".cbScroll"),m=n.height();m>h?g.height(g.height()-(m-h)):n.height()<h&&g.height(g.height()+(h-m))}p&&d.scrollTop(d.prop("scrollHeight"))}}},emoji:function(e){t("#chatboxEmoji_menu").find(".ipsEmoticons_contentLoading").length>0&&t(document).trigger("contentChange",[t("#chatboxEmoji_menu")]),t("#chatboxEmoji").attr("id","");var i=t(e.currentTarget);i.attr("id","chatboxEmoji"),i.attr("data-ipsmenu",""),i.attr("data-ipsmenu-closeonclick","false"),t("#chatboxEmoji_menu").attr("data-btnID",i.attr("data-btnID"))},zoomImage:function(e){var i="roomChat"==this.scope.closest(".bimChatbox").attr("id")?"room":"con",a=t(e.currentTarget).closest(".chat_row").attr("id"),o=t(e.currentTarget).attr("href");return ips.getAjax()(ips.getSetting("baseURL")+"index.php?app=chatbox&module=chatbox&controller=chatbox&do=zoomImage",{data:{from:i,chatID:a,thumb:o},type:"post"}).done(function(i){"error"==i.type?ips.ui.alert.show({message:i.message}):(t(e.currentTarget).removeAttr("data-action"),t(e.currentTarget).attr("data-ipslightbox",""),t(e.currentTarget).attr("href",i.image),t(e.currentTarget).click())}),!1},playVideoInPopup:function(e){var i=t(e.currentTarget).closest(".chatboxVideoContainer"),a=t(e.currentTarget).closest(".chat_row").attr("id");return t("body").append(ips.templates.render("chatbox.videoPopup",{chatID:a,play:i.attr("data-play"),html5:i.attr("data-html5")})),ips.ui.dialog.create({fixed:!1,size:"medium",forceReload:!0,content:".videopopup_"+a}).show(),this.stopPlayingVideos(),!1},playVideoInIframe:function(e){this.stopPlayingVideos();var i=t(e.currentTarget).closest(".chatboxVideoContainer");return i.find(".chatboxVideo").html(ips.templates.render("chatbox.videoIframe",{play:i.attr("data-play")})),!1},stopPlayingVideos:function(){this.scope.find(".chatboxPlayer").each(function(){if("VIDEO"==t(this).prop("nodeName"))t(this).get(0).pause();else{var e=t(this).closest(".chatboxVideoContainer");e.replaceWith(ips.templates.render("chatbox.parseVideo",{source:e.attr("data-source"),url:e.attr("data-url"),play:e.attr("data-play"),id:e.attr("data-id"),img:e.attr("data-img"),html5:e.attr("data-html5"),blankImage:null}))}})},oldScrollPos:null,focusChatInput:function(){if(this.lmn3=setInterval(e.bind(this.checkTyping,this),700),ips.utils.responsive.currentIs("tablet")||ips.utils.responsive.currentIs("phone")){var i=this,a=i.scope.closest(".bimChatbox").find("#chatInputArea");i.oldScrollPos=t(window).scrollTop(),t("html, body").scrollTop(a.offset().top)}},blurChatInput:function(){clearInterval(this.lmn3),null!=this.oldScrollPos&&t("html, body").scrollTop(this.oldScrollPos)},checkTyping:function(){var t=this.scope.find(".chatInput").val();if(t!=this.lmn4){if(0!=t.indexOf("/giphy ")){var e=this.scope.find(".chatboxMedia");e.is(":visible")&&e.empty().hide();return}this.lmn4=t;var i=t.split(" ")[0].toLowerCase();"asc"==this.lmn2.sort?this.scope.find(".chatboxMedia").css({bottom:this.scope.find("#chatInputArea").outerHeight()+30}):this.scope.find(".chatboxMedia").css({top:this.scope.height()-this.scope.find("#chatContentIframe").height()}),this.cmdMedia(i)}},cmdMedia:function(e){var i=this;if("/giphy"==e){if("cmd"!=i.lmn2.giphy&&"both"!=i.lmn2.giphy)return!1;this._ajax&&this._ajax.abort&&this._ajax.abort();var a=i.scope.find(".chatboxMedia");return a.is(":visible")||a.show(),a.empty().addClass("ipsLoading"),this._ajax=ips.getAjax()(ips.getSetting("baseURL")+"index.php?app=core&module=system&controller=plugins&do=bimGiphy&editorId=giphyCMD",{data:{q:i.lmn4.substring(e.length+1)},type:"post"}).done(function(e){a.html(e),t(document).trigger("contentChange",[i.scope.find(".chatboxMedia")])}).always(function(){a.removeClass("ipsLoading")}),!1}},bimGiphy:function(){if("roomChat"==this.scope.closest(".bimChatbox").attr("id"))var t="room";else var t="convo";var i=ips.getSetting("baseURL")+"index.php?app=core&module=system&controller=plugins&do=bimGiphy&editorId=chatbox_"+t+"_"+this.lmn1,a=ips.utils.db.get("bimgiphy_gif","recent"),o=null;return e.isArray(a)&&(o=JSON.stringify(a)),ips.ui.dialog.create({fixed:!1,size:"medium",title:ips.getString("bim_giphy"),url:i,forceReload:!0,ajax:{type:"post",data:{recent:o}}}).show(),!1},fileAdded:function(e,i){this.lmn2.autogrow&&t(e.target).closest("#chatInputArea").length>0&&(0==this.lmn5&&(this.lmn5=this.scope.closest(".bimChatbox").height()-this.scope.find(".ipsAttachment_fileList").height()),t(e.target).closest("#chatInputArea").addClass("expanded"),this.scope.find(".chatInput").focus(),this.resizeBox())},deletedFile:function(e,i){0===i.count&&this.lmn2.autogrow&&t(e.target).closest("#chatInputArea").length>0&&(t(e.target).closest("#chatInputArea").removeClass("expanded"),this.resizeBox())},resizeBox:function(){if(this.scope.closest(".inGlobalChat").length>0)t(".chatBar").trigger("resizeBar");else{var e=this.scope.closest(".bimChatbox").find(".cbScroll"),i=this.scope.closest(".bimChatbox").height();i>this.lmn5?e.height(e.height()-(i-this.lmn5)):this.scope.closest(".bimChatbox").height()<this.lmn5&&e.height(e.height()+(this.lmn5-i))}}})}(jQuery,_);;!function(t,e,n){"use strict";ips.controller.register("bim.chatbox.room",{lmn1:null,lmn2:null,lmn3:null,lmn4:null,lmn5:null,lmn6:null,lmn7:null,lmn8:12e4,lmn9:!0,lmn10:!1,lmn11:null,lmn12:null,lmn13:null,lmn14:null,lmn15:null,_lastMSG:0,_joined:0,lmn9:!0,lmn10:!1,lmn18:!0,lmn19:!0,lmn20:!1,lmn21:!1,lmn22:!1,lmn23:!1,lmn24:!1,lmn25:!1,lmn26:!1,lmn27:!1,lmn28:0,lmn29:null,lmn30:!1,lmn31:!1,lmn32:null,lmn33:0,initialize:function(){this.configRoom(),this.on("menuItemSelected","#listRooms",this.listRooms),this.on("click",'[data-action="toggleChat"]',this.toggleChat),this.on(window,"resize",this.resizeWindow),this.scope.closest(".bimChatbox").hasClass("inGlobalChat")||0!=t(".chatBoxFull").length||this.scope.closest(".bimChatbox").resizable({handles:"s",alsoResize:"#chatContentIframe, #userListIframe",stop:function(e,n){t(this).css("width","")}}),0==this.scope.find(".chatboxIndentifyGuest").length&&0==this.scope.find(".chatboxRulesWrapper").length&&(this.on("click",'.ipsButton[data-action="addToBlockedList"]',this.click_addToBlockedList),this.on("click",'[data-action="connect"]',this.connect),this.on("click",'[data-action="chattersList"]',this.chattersList),this.on("change",'select[data-action="changeStyle"]',this.selectChangeStyle),this.on("menuItemSelected","#roomOptions"+this.lmn2,this.roomOptions),this.on("menuItemSelected",".msgAction",this.msgAction),this.on("click",'[data-action="mention"]',this.mention),this.on("click",'[data-action="donate"]',this.donate),this.on("click",'[data-action="refresh"]',this.refresh),this.on("submit",".chatboxEditor",this.submitEditor),this.lmn1.use_editor||(this.on("click",'#chatInputArea [data-action="sendMSG"]',this.clickSubmit),this.on("keypress","#chatInputArea textarea",this.enterSubmit)),this.lmn1.autoload?this.scope.find("#chatContentIframe").on("scroll",e.bind(this.autoLoad,this)):this.on("click",'[data-action="loadMore"]',this.loadMore),this.startRoom()),this.scope.find(".chatboxIndentifyGuest").length>0&&(this.on("click",'[data-action="saveGuestName"]',this.saveGuestName),this.on("onsubmit",'[data-action="guestForm"]',this.saveGuestName),1!=this.lmn1.auto_guest||this.scope.closest(".bimChatbox").hasClass("minimize")||(this.scope.find(".guestName").val("Guest"+t.now()),this.scope.find('[data-action="saveGuestName"]').click())),this.scope.find(".chatboxRulesWrapper").length>0&&this.on("submit",".chatboxRulesWrapper form",this.acceptRules);var n=this.scope.closest(".chatboxWidget");if(n.length>0){var a=n.closest(".cWidgetContainer").width();n.css({width:"100%","max-width":a+"px !important"}).show()}},configRoom:function(){if(this.lmn2=this.scope.attr("data-roomID"),this.lmn1=ips.getSetting("chatbox_"+this.lmn2),this.updateStyle(),this.lmn3=ips.getSetting("baseURL")+"index.php?app=chatbox&module=chatbox&controller=room&id="+this.lmn2,this.lmn11=ips.getSetting("lazyLoadEnabled")?ips.getSetting("blankImg"):null,this.lmn4file=this.lmn1.soundfile?this.lmn1.soundfile:ips.getSetting("baseURL")+"applications/core/interface/sounds/notification.mp3",this.lmn28=this.scope.find("#chatContentIframe").height(),t(".chatBoxFull").length){var e=t(".bimChatbox").height(),n=t("#chatContentIframe").height(),a=e-n;t("#chatContentIframe").height(t(window).innerHeight()-a),t("#userListIframe").height(t(window).innerHeight()-a),t(".chatBoxFull").show(),t(window).resize(function(){t("#chatContentIframe").height(t(window).innerHeight()-a),t("#userListIframe").height(t(window).innerHeight()-a),t(".chatBoxFull").show()}),this.lmn28=t("#chatContentIframe").height(),document.title=this.lmn1.roomname}this.scope.closest(".bimChatbox").hasClass("inGlobalChat")&&(this.lmn31=!!ips.utils.cookie.get("chatbox_is_silent")),this.fixTheSize()},startRoom:function(){var e=this;ips.loader.get(["core/interface/howler/howler.core.min.js"]).then(function(){e.lmn4=new Howl({src:e.lmn4file,autoplay:!1})}),t(".convoList").length<=0&&chatbox.initTimeago(),this.lmn1.musicbox&&this.jPlayer(),this.autoMessages(),this.ping(!0)},fixTheSize:function(){if(this.scope.closest(".chatBar").length>0){var e=!0;if(ips.getSetting("chatbox_bar_mini")&&(t.each(ips.getSetting("chatbox_bar_mini").split(","),function(t,n){if(ips.utils.responsive.currentIs(n.toLowerCase()))return e=!1,!1}),!e))return}else if(this.scope.closest(".chatboxWidget").length>0){var e=!0,n=this.scope.closest(".chatboxWidget");if(n.attr("data-automini")&&(t.each(n.attr("data-automini").split(","),function(t,n){if(ips.utils.responsive.currentIs(n.toLowerCase()))return e=!1,!1}),!e))return}this.toggleOn()},autoMessages:function(){var e=this.lmn1.automsg;if(!e)return!1;var n=e.bot,a=this;t.each(e.messages,function(e,o){n.content=o.msg,n.showAgoTime=Math.floor(Date.now()/1e3);var i=[n],s=a.scope.find("#chatContentIframe"),r=a.scope.find("#chatContent");setInterval(function(){if("asc"==a.lmn1.sort){if(s.scrollTop()+s.innerHeight()-s.prop("scrollHeight")>=-30)var e=1;r.append(a.chatRowHTML(i)),t(document).trigger("contentChange",[r]),(1==e||a.lmn25)&&a.goDown()}else r.prepend(a.chatRowHTML(i)),t(document).trigger("contentChange",[r]);if(t(".timeago:not(.loadedAgo)").timeago(),a.lmn1.limit>0&&!a.lmn24){var n=r.children().length-a.lmn1.limit;n>0&&r.find("li:nth"+("asc"==a.lmn1.sort?"":"-last")+"-child(-n+"+n+")").remove()}a.lmn31||1==ips.utils.cookie.get("chatbox_nosound_"+a.lmn2)||a.lmn19||a.lmn23||a.lmn4.play()},1e3*o.time)})},ping:function(t){var e=this;if(e.scope.closest(".bimChatbox").hasClass("minimize")&&!e.lmn1.alwaysON||this.lmn26&&!this.lmn9)return!1;!0==t&&clearTimeout(e.lmn7),e.doPing(function(){e.lmn7=setTimeout(function(){e.ping(!0)},e.lmn8)})},doPing:function(e){var n=this;return 0==t(".room_"+n.lmn2).length?(n.stopUpdate(),!1):!n.lmn10&&void(n.lmn10=!0,ips.getAjax()(n.lmn3+"&do=ping",{type:"post",dataType:"json"}).done(function(t){"error"==t.type?ips.ui.alert.show({message:t.message}):"errorGuestName"==t.type?(n.stopUpdate(),location.reload()):(n.lmn9&&(n.updateChat(!0),n.lmn9=!1),n.lmn10=!1,"function"==typeof e&&e()),1!=n._joined&&(n._joined=1,n.lmn3=n.lmn3+"&joined="+n._joined)}).fail(function(){1==ips.getSetting("chatbox_no_disconnect")?(n.lmn10=!1,"function"==typeof e&&e()):n.disconnect()}))},refresh:function(){return this.lmn19||this.updateChat(!0),!1},updateChat:function(t){var e=this;if(e.scope.closest(".bimChatbox").hasClass("minimize")&&!e.lmn1.alwaysON||e.lmn26&&!e.lmn19)return!1;!0==t&&clearTimeout(e.lmn6);var n=e.lmn1.interval>=5e3?e.lmn1.interval:5e3;e.doUpdateChat(function(){e.lmn6=setTimeout(function(){e.updateChat(!0)},n)})},doUpdateChat:function(e){var n=this;if(n.lmn19&&chatbox.initCleanEditor(n.scope),0==t(".room_"+n.lmn2).length)return n.stopUpdate(),!1;if(n.lmn20)return!1;if(n.lmn20=!0,"asc"==n.lmn1.sort)var a=n._lastMSG>0?n._lastMSG:n.scope.find(".chat_row").last().attr("id");else var a=n._lastMSG>0?n._lastMSG:n.scope.find(".chat_row").first().attr("id");ips.getAjax()(n.lmn3+"&do=getMSG",{dataType:"json",type:"post",data:{lastID:a||0,firstLoad:n.lmn19?1:0,loadMoreMode:0,isReconnect:n.lmn27?1:0}}).done(function(a){if("error"==a.type)ips.ui.alert.show({message:a.message});else if("isBlocked"==a.type){n.kick();return}else{if(n.lmn19&&n.scope.find("#chatboxRoom .ipsLoading").removeClass("ipsLoading"),n.lmn27&&n.connected(),n.scope.find(".colUserList").length>0){if(a.chatters){var o=Object.keys(a.chatters);if(n.lmn1.theLastUser!=o[1]||n.lmn19){n.lmn1.theLastUser=o[1];var i=n.scope.find("#userList");i.html(n.chattersListFormat(a.chatters)),t(document).trigger("contentChange",[i])}}else n.lmn1.theLastUser=0}if(a.content){var s=n.scope.find("#chatContentIframe"),r=n.scope.find("#chatContent");if("asc"==n.lmn1.sort){if(s.scrollTop()+s.innerHeight()-s.prop("scrollHeight")>=-30)var c=1;r.append(n.chatRowHTML(a.content)),n.lmn19&&!n.lmn1.autoload&&a.content.length==n.lmn1.limit&&r.prepend(ips.templates.render("chatbox.loadMoreBtn")),t(document).trigger("contentChange",[s]),(1==c||n.lmn25)&&n.goDown()}else r.prepend(n.chatRowHTML(a.content)),n.lmn19&&!n.lmn1.autoload&&a.content.length==n.lmn1.limit&&r.append(ips.templates.render("chatbox.loadMoreBtn")),t(document).trigger("contentChange",[s]);if(t(".timeago:not(.loadedAgo)").timeago(),a.updateAnn){var l=n.scope.find(".cbAnn");if("remove"==a.updateAnn)n.lmn19||l.hide();else{l.show();var h=n.scope.closest(".bimChatbox").hasClass("inGlobalChat")||1!=a.updateAnn[2]?0:1;l.find(".annTitle").html(a.updateAnn[h])}}n.lmn31||1==ips.utils.cookie.get("chatbox_nosound_"+n.lmn2)||n.lmn19||n.lmn23||n.lmn4.play(),r.find("img").imagesLoaded(function(t){n.lmn19=!1})}n._lastMSG=a.lastID,a.update&&t.each(a.update,function(t,e){e?n.scope.find("#"+t+" .chatbox_msg").html(n.parseContent(e)):n.scope.find("#"+t).remove()}),1!=n.lmn1.musicbox||(a.song?n.lmn19||(a.song.id!=n.lmn12&&(n.lmn1.song=a.song),n.playSong()):n.hideMusicPlayer())}n.lmn20=!1,"function"==typeof e&&e()}).fail(function(){1==ips.getSetting("chatbox_no_disconnect")?(n.lmn20=!1,"function"==typeof e&&e()):n.disconnect()}).always(function(t){n.lmn25=!1,n.lmn23=!1})},msgAction:function(e,n){(e=n?n.originalEvent:e).preventDefault();var a=t(e.target).attr("data-action"),o=t(e.target).attr("data-chatID");if(a)switch(a){case"edit":this.editEditor(o);break;case"delete":this.deleteMSG(o);break;case"report":this.reportMSG(o);break;case"addToBlockedList":var i=t(e.target).attr("data-key"),s=t(e.target).attr("data-ip"),r=t(e.target).attr("data-name");this.addToBlockedList(o,i,r,s)}return!1},deleteMSG:function(t){var e=this;return ips.ui.alert.show({type:"confirm",message:ips.getString("chatbox_confirmDelete"),icon:"warn",buttons:{ok:ips.getString("chatbox_confirm_yes"),cancel:ips.getString("chatbox_confirm_cancel")},callbacks:{ok:function(){ips.getAjax()(e.lmn3+"&do=deleteMSG",{type:"post",data:{chatID:t}}).done(function(n){"error"==n.type?ips.ui.alert.show({message:n.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_deleted")),e.scope.find("li#"+t).remove())})}}}),!1},reportMSG:function(e){var n=ips.ui.dialog.create({url:ips.getSetting("baseURL")+"index.php?app=chatbox&module=chatbox&controller=msg&do=report&id="+e,size:"medium",title:ips.getString("chatbox_report"),forceReload:!1,destructOnClose:!0,callback:function(e){t(e).find("form").on("submit",function(e){for(var a in e.preventDefault(),CKEDITOR.instances)CKEDITOR.instances[a].updateElement();var o=t(e.currentTarget);return ips.getAjax()(o.attr("action"),{data:o.serialize(),type:"post",bypassRedirect:!0}).done(function(t){ips.ui.flashMsg.show(ips.getString("chatbox_sent_report"))}).always(function(t){n.hide()}),!1})}});return n.show(),!1},chatRowHTML:function(e){var n=this,a="",o="",i="",s="chatbox.style."+this.lmn1.style,r=ips.getSetting("chatbox_userFormat"),c="";return t.each(e,function(t,e){var l=e.id>0?e.id:0;if(!(l>0)||!(n.scope.find("#chatRow_"+l).length>0)){if(-1!=e.chatterID){var h=!!n.lmn1.canManage&&e.chatterID!=ips.getSetting("memberID");if(e.chatterID>0&&(o=(i=ips.getSetting("baseURL")+"index.php?app=core&module=members&controller=profile&id="+e.chatterID)+"&do=hovercard"),e.donation&&e.donation.amount)var m=parseFloat(e.donation.amount.replace(",",".").replace(" ",""));var d=m?n.superChatBackground(m):null,g=d?chatbox.invertColor(d,!0):null,u=d?chatbox.invertColor(d):null;c=e.chatterName,void 0!==r[e.chatterGroup]&&null!==r[e.chatterGroup]&&(c=r[e.chatterGroup].prefix+e.chatterName+r[e.chatterGroup].suffix),a+=ips.templates.render(d?"chatbox.style.superchat":s,{id:l,chatterID:e.chatterID,chatterName:e.chatterName,chatterKey:e.chatterKey,chatterNameFormat:c,chatterPhoto:e.chatterID>0?e.chatterPhoto:"https://www.gravatar.com/avatar/"+e.chatterPhoto+"?s=32&d=wavatar&r=PG",chatterUrl:i,chatterIP:e.chatterIP,memberHovercard:o,content:n.parseContent(e.content),callme:-1!=e.content.indexOf("@"+ips.getSetting("chatbox_member_name")),isMe:e.chatterName==ips.getSetting("chatbox_member_name"),inDay:e.inDay,time:e.time,mainBg:d,subBg:"FFFFFF"==g?"rgba(255, 255, 255, 0.075)":"rgba(82.7, 82.7, 82.7, 0.04)",mainTxt:g,subTxt:u,money:e.donation?e.donation.money:0,canEdit:e.canEdit,canDelete:e.canDelete,canReport:e.chatterName!=ips.getSetting("chatbox_member_name")&&e.canReport,canBeBlocked:h,canManageMSG:e.canEdit||e.canDelete||e.canReport||h})}else n.lmn1.bot_id>0?(c=n.lmn1.bot_name,void 0!==r[n.lmn1.bot_group]&&null!==r[n.lmn1.bot_group]&&(c=r[n.lmn1.bot_group].prefix+n.lmn1.bot_name+r[n.lmn1.bot_group].suffix),a+=ips.templates.render(s,{id:l,chatterID:n.lmn1.bot_id,chatterName:n.lmn1.bot_name,chatterNameFormat:c,chatterPhoto:n.lmn1.bot_photo,chatterUrl:n.lmn1.bot_url,memberHovercard:ips.getSetting("baseURL")+"index.php?app=core&module=members&controller=profile&id="+n.lmn1.bot_id+"&do=hovercard",content:"<i class='fa fa-angle-double-right'></i> "+e.content,callme:-1!=e.content.indexOf("@"+ips.getSetting("chatbox_member_name")),isMe:n.lmn1.bot_name==ips.getSetting("chatbox_member_name"),inDay:e.inDay,time:e.time,canDelete:e.canDelete})):a+=ips.templates.render("chatbox.style.room.system",{id:e.id,content:e.content,inDay:e.inDay,time:e.time,canDelete:e.canDelete})}}),""==a&&(n.lmn23=!0),a},superChatBackground:function(e){var n=null;return t.each(this.lmn1.superchat,function(t,a){if(e>=parseFloat(a.amount.replace(",",".").replace(" ","")))return n=a.color,!1}),n},parseContent:function(t){return this.lmn1.use_editor?t:chatbox.parseContent(t,this.lmn1)},chattersListFormat:function(e){var n="",a="",o="",i=ips.getSetting("chatbox_userFormat"),s=this;return t.each(e,function(t,e){var r=!!s.lmn1.canManage&&e.chatterID!=ips.getSetting("memberID"),c=i[e.chatterGroup].prefix+e.chatterName+i[e.chatterGroup].suffix;e.chatterID>0&&(a=(o=ips.getSetting("baseURL")+"index.php?app=core&module=members&controller=profile&id="+e.chatterID)+"&do=hovercard"),e.is_anon&&s.lmn1.hideAnon&&!s.lmn1.canManage&&e.chatterID!=ips.getSetting("memberID")||(n+=ips.templates.render("chatbox.chatter.row",{chatterKey:e.key,chatterID:e.chatterID,chatterIP:e.ip,chatterName:e.chatterName,chatterNameFormat:c,chatterPhoto:e.chatterID>0?e.chatterPhoto:"https://www.gravatar.com/avatar/"+e.chatterPhoto+"?s=32&d=wavatar&r=PG",chatterUrl:e.chatterUrl,memberHovercard:a,canBeBlocked:r,privateChat:e.chatterID!=ips.getSetting("memberID")&&e.privateChat,islmn34:s.lmn1.hideAnon?e.is_anon:null}))}),n},chattersList:function(e){t("#chattersList_"+this.lmn2+"_menu").length||t(".chatboxContainer").append(ips.templates.render("chatbox.chatters.list",{roomID:this.lmn2}));var n=this;ips.getAjax()(n.lmn3+"&do=chattersList",{type:"post",dataType:"json"}).done(function(e){"error"==e.type&&ips.ui.alert.show({message:e.message});var a=n.scope.find(".chatbox_chatters_Panel");a.hasClass("ipsLoading")&&a.removeClass("ipsLoading"),a.find(".ipsDataList").html(n.chattersListFormat(e.list)),t(document).trigger("contentChange",[a])})},listRooms:function(e,n){(e=n?n.originalEvent:e).preventDefault(),"changeRoom"===t(e.target).attr("data-action")&&this.changeRoom(e,n)},changeRoom:function(e,n){n.originalEvent.preventDefault();var a=this,o=t(e.target).attr("data-newroom"),i=t(e.target).closest(".bimChatbox").hasClass("inGlobalChat")?1:0,s=t(e.target).closest(".cWidgetContainer").length>0?a.scope.closest(".cWidgetContainer").attr("data-orientation"):"",r=t(e.target).closest(".bimChatbox").hasClass("minimize");return ips.getAjax()(a.lmn3+"&do=changeRoom",{type:"post",dataType:"json",data:{newroom:o,inGlobal:i,inWidget:s}}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):e.url?window.location.replace(e.url):(a.stopUpdate(),a.scope.closest(".bimChatbox").replaceWith(e.html),r||t(".room_"+o).removeClass("minimize"),ips.setSetting("chatbox_"+o,e.config),t(document).trigger("contentChange",[t(".room_"+o)]),t(".chatBar").trigger("resizeBar"))}),!1},roomOptions:function(e,n){switch((e=n?n.originalEvent:e).preventDefault(),t(e.target).attr("data-action")){case"toggleSound":this.toggleSound(n);break;case"openWindowTab":this.openWindowTab(e,n);break;case"cleanRoom":this.cleanRoom(n);break;case"makeAnnouncement":this.makeAnnouncement(n);break;case"blockedChatters":this.blockedChatters(n);break;case"changeSkin":this.changeSkin(e,n);break;case"changeStyle":this.changeStyle(e,n);break;case"selectSong":this.selectSong(e,n);break;case"archive":window.open(t(e.target).attr("href"),"_blank");break;case"leaveRoom":this.leaveRoom(e,n)}},toggleSound:function(e){e.originalEvent.preventDefault();var n=ips.utils.cookie.get("chatbox_nosound_"+this.lmn2);this.scope.find('[data-action="toggleSound"] .fa').replaceWith(t("<i/>").addClass("fa").addClass(1!=n?"fa-volume-off":"fa-volume-up").removeClass(1!=n?"fa-volume-up":"fa-volume-off")),1==n?ips.utils.cookie.set("chatbox_nosound_"+this.lmn2,0):ips.utils.cookie.set("chatbox_nosound_"+this.lmn2,1),ips.ui.flashMsg.show(ips.utils.cookie.get("chatbox_nosound_"+this.lmn2)?ips.getString("chatbox_soundDisabled"):ips.getString("chatbox_soundEnabled"))},openWindowTab:function(e,n){n.originalEvent.preventDefault();var a=t(e.target).closest(".bimChatbox"),o=t(e.target).attr("href");if(o){var i=a.width(),s=a.height(),r=t(window).width()/2-i/2,c=t(window).height()/2-s/2;if(this.lmn1.use_editor)var l="directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,width="+i+",height="+(s+=25)+",top="+c+", left="+r;else var l="directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width="+i+",height="+s+",top="+c+", left="+r;window.open(o,"chatInPopup",l)}return!1},cleanRoom:function(t){t.originalEvent.preventDefault();var e=this;return ips.ui.alert.show({type:"confirm",message:ips.getString("chatbox_confirmClean"),icon:"warn",buttons:{ok:ips.getString("chatbox_confirm_yes"),cancel:ips.getString("chatbox_confirm_cancel")},callbacks:{ok:function(){ips.getAjax()(e.lmn3+"&do=cleanRoom").done(function(t){"error"==t.type?ips.ui.alert.show({message:t.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_deleted_all")),e.scope.find("#chatContent").empty())})}}}),!1},makeAnnouncement:function(e){e.originalEvent.preventDefault();var n=this,a=ips.ui.dialog.create({url:n.lmn3+"&do=makeAnnouncement",size:"normal",title:ips.getString("chatbox_announcement"),forceReload:!1,destructOnClose:!0,callback:function(){t(".chatboxAnnForm").on("submit",function(e){for(var o in e.preventDefault(),CKEDITOR.instances)CKEDITOR.instances[o].updateElement();var i=t(e.currentTarget);return ips.getAjax()(i.attr("action"),{data:i.serialize(),type:"post",bypassRedirect:!0}).done(function(t){"error"==t.type?ips.ui.alert.show({message:t.message}):(t.title?(n.scope.find(".cbAnn").show(),n.scope.find(".cbAnn .annTitle").text(t.title)):n.scope.find(".cbAnn").hide(),n.updateChat(!0))}).always(function(t){a.hide()}),!1})}});return a.show(),!1},leaveRoom:function(e){e.originalEvent.preventDefault();var n=this;return ips.ui.alert.show({type:"confirm",message:ips.getString("chatbox_confirmLeave"),icon:"warn",buttons:{ok:ips.getString("chatbox_confirm_yes"),cancel:ips.getString("chatbox_confirm_cancel")},callbacks:{ok:function(){n.stopUpdate(),ips.getAjax()(n.lmn3+"&do=leaveRoom").done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):"chatbox"!=t("body").attr("data-pageapp")||"room"!=t("body").attr("data-pagecontroller")||n.scope.closest(".bimChatbox").hasClass("inGlobalChat")?n.toggleChat():window.location.replace(ips.getSetting("baseURL"))})}}}),!1},blockedChatters:function(e){e.originalEvent.preventDefault();var n=this;return ips.ui.dialog.create({url:n.lmn3+"&do=blockedChatters",size:"normal",title:ips.getString("chatbox_blockedchatters"),forceReload:!0,destructOnClose:!0,callback:function(){t("[data-action='unblock']").on("click",function(e){return ips.getAjax()(n.lmn3+"&do=unblock",{type:"post",data:{key:t(e.currentTarget).attr("data-key")}}).done(function(n){"error"==n.type?ips.ui.alert.show({message:n.message}):t(e.currentTarget).closest(".userRow").remove()}),!1})}}).show(),!1},addToBlockedList:function(e,n,a,o){var i=this,s=ips.ui.dialog.create({url:i.lmn3+"&do=addToBlockedList&key="+n+"&ip="+o+"&name="+a,size:"narrow",forceReload:!0,destructOnClose:!0,callback:function(){t(".chatboxBlockUser").on("submit",function(a){a.preventDefault();var o=t(a.currentTarget);return ips.getAjax()(o.attr("action"),{data:o.serialize(),type:"post",bypassRedirect:!0}).done(function(t){ips.ui.flashMsg.show(t.message),null!=e&&i.scope.find("li#"+e).remove(),1==t.deleted&&i.scope.find("[data-key='"+n+"']").closest(".chat_row").remove()}).always(function(t){s.hide()}),!1})}});return s.show(),!1},changeSkin:function(e,n){n.originalEvent.preventDefault();var a=t(e.target).data("skin");return t(e.target).closest(".chatboxSkins").find("li").removeClass("skinSelected"),t(e.target).addClass("skinSelected"),t(e.target).closest(".bimChatbox").removeClass(function(t,e){return(e.match(/(^|\s)skin_\S+/g)||[]).join(" ")}),t(e.target).closest(".bimChatbox").addClass("skin_"+a),ips.utils.cookie.set("chatbox_skin_"+this.lmn2,a),!1},changeStyle:function(e,n){n.originalEvent.preventDefault();var a=this;return t(e.target).one("change",function(){return a.applyNewStyle(this.value),!1}),!1},applyNewStyle(t){ips.utils.cookie.get("chatbox_style_"+this.lmn2)!=t&&(ips.utils.cookie.set("chatbox_style_"+this.lmn2,t),this.updateStyle(),this.stopUpdate(),this.connect())},updateStyle:function(){this.lmn1.style=1==this.lmn1.allow_select_skins&&ips.utils.cookie.get("chatbox_style_"+this.lmn2)?ips.utils.cookie.get("chatbox_style_"+this.lmn2):this.lmn1.style?this.lmn1.style:"standard"},selectChangeStyle:function(e){var n=t(e.currentTarget).find(":selected").val();return this.applyNewStyle(n),!1},disconnect:function(){return this.lmn27?(ips.ui.alert.show({message:ips.getString("chatbox_can_not_connect")}),this.scope.find("#btnConnect").html(ips.getString("chatbox_reconnect")),this.scope.find("#btnConnect").attr("disabled",!1),!1):(this.stopUpdate(),this.lmn27=!0,this.scope.prepend(ips.templates.render("chatbox.disconnected",{msg:ips.getString("chatbox_disconnected"),btn:ips.getString("chatbox_reconnect")})),!1)},connect:function(){return this.scope.find("#btnConnect").attr("disabled",!0),this.scope.find("#btnConnect").html('<i class="fa fa-refresh fa-spin"></i> '+ips.getString("chatbox_connecting")),this.scope.find("#chatContent").empty(),this.lmn19=!0,this.lmn20=!1,this._lastMSG=0,this.updateChat("true"),!1},connected:function(){this.lmn27=!1,this.scope.find(".disconnected").remove(),ips.ui.flashMsg.show(ips.getString("chatbox_connected"))},kick:function(){return this.stopUpdate(),this.lmn27=!0,this.scope.prepend(ips.templates.render("chatbox.disconnected",{msg:ips.getString("chatbox_isblocked")})),!1},toggleInputForm:function(e){var n=this.scope.find(".chatInput"),a=this.scope.find('[data-action="sendMSG"]');1==e?(this.lmn21=!1,a.prop("disabled",!1),n.val(""),n.closest("#chatInputArea").hasClass("expanded")&&(n.closest("#chatInputArea").removeClass("expanded"),n.css("height","auto"),this.scope.find("#chatContentIframe").height(this.lmn28),this.scope.find("#userListIframe").height(this.lmn28),t(".chatBar").trigger("resizeBar"))):(this.lmn21=!0,a.prop("disabled",!0))},toggleChat:function(){var e=this;return e.scope.closest(".bimChatbox").hasClass("minimize")?(ips.utils.cookie.set("chatbox_room_off_"+e.lmn2,0),e.scope.closest(".bimChatbox").removeClass("minimize"),ips.getSetting("chatbox_member_name")&&1!=e.scope.find(".chatboxRulesWrapper").length&&(e.ping(!0),e.lmn19||e.updateChat(!0)),t(".chatBar").trigger("resizeBar")):(ips.utils.cookie.set("chatbox_room_off_"+e.lmn2,1),e.scope.closest(".bimChatbox").addClass("minimize"),e.stopUpdate(),e.lmn15=t.now()),!1},toggleOn:function(){var e="chatbox"==t("body").attr("data-pageapp")&&"room"==t("body").attr("data-pagecontroller");this.scope.closest(".bimChatbox").hasClass("minimize")&&(e||!e&&1!=ips.utils.cookie.get("chatbox_room_off_"+this.lmn2))&&this.toggleChat()},stopUpdate:function(){clearTimeout(this.lmn6),clearTimeout(this.lmn7)},loadMore:function(e){var n=this;if(n.lmn24)return!1;var a=n.scope.find("#chatContentIframe"),o=a.find("#chatContent"),i="asc"==n.lmn1.sort?o.children(".chat_row:first").attr("id"):o.children(".chat_row:last").attr("id");return n.lmn24=!0,ips.getAjax()(n.lmn3+"&do=getMSG",{dataType:"json",type:"post",data:{lastID:i||0,loadMoreMode:1}}).done(function(o){"error"==o.type?ips.ui.alert.show({message:o.message}):1==o.noMore?(t(e.currentTarget).remove(),ips.ui.flashMsg.show(ips.getString("chatbox_no_older"))):o.content&&("asc"==n.lmn1.sort?(t(e.currentTarget).after(n.chatRowHTML(o.content)),a.scrollTop(n.scope.find("#"+i).position().top-50)):t(e.currentTarget).before(n.chatRowHTML(o.content)),t(document).trigger("contentChange",[n.scope.find("#chatContentIframe")]),t(".timeago:not(.loadedAgo)").timeago())}).fail(function(){1!=ips.getSetting("chatbox_no_disconnect")&&n.disconnect()}).always(function(){n.lmn23=!1,n.lmn24=!1}),!1},autoLoad:function(){if(this.lmn19||!this.lmn18)return!1;var e=this,n=e.scope.find("#chatContentIframe"),a=n.find("#chatContent");if("asc"==this.lmn1.sort){if(!this.lmn30&&0!=n.scrollTop())return!1;var o=a.children().first().attr("id")}else{if(!this.lmn30&&n.scrollTop()+n.innerHeight()<n[0].scrollHeight)return!1;var o=a.children().last().attr("id")}if(n.find("#loadMore").length<=0){var i=ips.templates.render("chatbox.loadMore");"asc"==this.lmn1.sort?a.prepend(i):a.append(i)}e.lmn30=!1,e.lmn18=!1,e.lmn24=!0,ips.getAjax()(e.lmn3+"&do=getMSG",{dataType:"json",type:"post",data:{lastID:o||0,loadMoreMode:1}}).done(function(i){"error"==i.type?ips.ui.alert.show({message:i.message}):1==i.noMore?ips.ui.flashMsg.show(ips.getString("chatbox_no_older")):(i.content&&("asc"==e.lmn1.sort?(a.prepend(e.chatRowHTML(i.content)),n.scrollTop(e.scope.find("#"+o).position().top-50)):a.append(e.chatRowHTML(i.content)),t(document).trigger("contentChange",[e.scope.find("#chatContentIframe")]),t(".timeago:not(.loadedAgo)").timeago(),e.lmn18=!0),("asc"==e.lmn1.sort?a.children().first().attr("id"):a.children().last().attr("id"))==o&&(e.lmn30=!0,e.autoLoad())),n.find("#loadMore").remove()}).fail(function(){1!=ips.getSetting("chatbox_no_disconnect")&&e.disconnect()}).always(function(){e.lmn23=!1,e.lmn24=!1})},saveGuestName:function(e){e.preventDefault();var n=this,a=n.scope.closest(".bimChatbox").hasClass("inGlobalChat")?1:0,o=n.scope.closest(".cWidgetContainer").length>0?n.scope.closest(".cWidgetContainer").attr("data-orientation"):"",i=n.scope.find("button");i.attr("disabled",!0),i.html('<i class="fa fa-refresh fa-spin"></i> '+ips.getString("chatbox_connecting"));var s=n.scope.find(".guestName").val();return ips.getAjax()(n.lmn3+"&do=changeName",{type:"post",dataType:"json",data:{name:s,inGlobal:a,inWidget:o}}).done(function(e){"error"==e.type||"errorGuestName"==e.type?ips.ui.alert.show({message:e.message}):(n.scope.closest(".bimChatbox").replaceWith(e.html),1==a&&(t(".room_"+n.lmn2).removeClass("minimize"),t(document).trigger("contentChange",[t(".room_"+n.lmn2)]),t(".chatBar").trigger("resizeBar")),t(document).trigger("contentChange",[t(".room_"+n.lmn2)]),ips.ui.flashMsg.show(e.message))}).always(function(){i.attr("disabled",!1),i.html(ips.getString("chatbox_save_name"))}),!1},acceptRules:function(e){e.preventDefault();var n=this,a=t(e.currentTarget),o=n.scope.closest(".bimChatbox").hasClass("inGlobalChat")?1:0,i=n.scope.closest(".cWidgetContainer").length>0?n.scope.closest(".cWidgetContainer").attr("data-orientation"):"",s=n.scope.closest(".chatBar").length>0?1:0;return ips.getAjax()(a.attr("action"),{data:a.serialize()+"&inGlobal="+o+"&inWidget="+i+"&openFromBar="+s,type:"post",bypassRedirect:!0}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):(n.scope.closest(".bimChatbox").replaceWith(e.html),1==o&&t(".room_"+n.lmn2).removeClass("minimize"),t(document).trigger("contentChange",[t(".room_"+n.lmn2)]),t(".chatBar").trigger("resizeBar"))}),!1},mention:function(t){return t.preventDefault(),chatbox.mention(t,this.lmn1.use_editor),!1},enterSubmit:function(t){if(13===t.which)return this.clickSubmit(),!1},clickSubmit:function(){return this.scope.find(".chatboxEditor").submit(),!1},click_addToBlockedList:function(e){var n=t(e.currentTarget).attr("data-key"),a=t(e.currentTarget).attr("data-ip"),o=t(e.currentTarget).attr("data-name");return this.addToBlockedList(null,n,o,a),!1},submitEditor:function(e){e.preventDefault();var n=this,a=n.scope.find(".chatboxEditor");if(n.lmn21)return!1;if(n.lmn1.use_editor)var o=CKEDITOR.instances["chatMSG_"+n.lmn2],i=o.getData();else{var i=a.find("textarea").val();i=chatbox.escapeHTML(i)}return(0!=n.scope.find(".chatboxEditor .ipsAttach_done").length&&!i||0!=n.checkMSG(i))&&0!=n.checkFlood()&&(o?a.find('button[type="submit"]').prop("disabled",!0).text(ips.getString("chatbox_posting")):n.toggleInputForm(0),n.lmn21=!0,ips.getAjax()(a.attr("action"),{data:a.serialize(),type:"post",bypassRedirect:!0}).done(function(e){"error"==e.type?(ips.ui.alert.show({message:e.message}),n.lmn21=!1):"errorGuestName"==e.type?(n.stopUpdate(),location.reload()):(n.lmn23=!0,n.updateChat(!0),n.lmn1.lastchat=t.now(),t(".chatBar").trigger("resizeBar"))}).always(function(){n.lmn24=!1,n.lmn21=!1,n.lmn25=!0,o?(ips.ui.editor.getObj(n.scope.find('[data-role="chatboxFormArea"] [data-ipsEditor]')).reset(),a.find('button[type="submit"]').prop("disabled",!1).text(ips.getString("chatbox_send"))):(n.toggleInputForm(1),n.scope.find(".charCount").hide(),n.scope.find('#chatInputArea [data-role="deleteFile"]').length>0&&n.scope.find('#chatInputArea [data-role="deleteFile"]').each(function(){t(this).click()}))}),!1)},editEditor:function(e){var n=this,a=t(".room_"+n.lmn2),o=ips.ui.dialog.create({url:n.lmn3+"&do=editEditor&chatID="+e,size:n.lmn1.use_editor?"normal":"narrow",title:ips.getString("chatbox_edit"),forceReload:!0,destructOnClose:!0,callback:function(){if(n.lmn1.use_editor)var i=t(".ipsDialog_content .cbEditorEdit");else{var i=t(".ipsDialog_content .cbCleanTextEdit");i.find("textarea").on("keypress",function(t){if(13===t.which)return i.submit(),!1})}i.on("submit",function(i){if(i.preventDefault(),n.lmn1.use_editor){var s=CKEDITOR.instances["chatMSG_"+n.lmn2+"_"+e];s.updateElement();var r=s.getData()}else{var r=t(this).find("textarea").val();r=chatbox.escapeHTML(r)}if((0==t(i.currentTarget).find(".ipsAttach_done").length||r)&&0==n.checkMSG(r))return!1;var c=t(i.currentTarget).serializeArray();return c.push({name:"newMsg",value:r}),ips.getAjax()(t(i.currentTarget).attr("action"),{data:t.param(c),type:"post",bypassRedirect:!0}).done(function(o){"error"==o.type?ips.ui.alert.show({message:o.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_edited")),a.find("#chatRow_"+e+" .chatbox_msg").html(n.parseContent(o.content)),t(document).trigger("contentChange",[a.find(".chatboxContainer")]))}).always(function(){o.hide()}),!1})}});return o.show(),!1},checkFlood:function(){if(this.lmn1.flood>0&&!this.lmn1.canManage&&!this.lmn1.canBypassFlood){var e=(t.now()-this.lmn1.lastchat)/1e3;if(e<this.lmn1.flood)return ips.ui.alert.show({message:ips.getString("chatbox_error_flood",{time:(this.lmn1.flood-e).toFixed(2)})}),0}return 1},checkMSG:function(t){var t=t.trim(),e=this.lmn1.length;return t.length<=0?(ips.ui.alert.show({message:ips.getString("chatbox_error_empty")}),0):e>0&&t.length>e?(ips.ui.alert.show({message:ips.pluralize(ips.getString("chatbox_error_maxlength"),e)}),0):1},selectSong:function(n){n.originalEvent.preventDefault();var a=this;return ips.ui.dialog.create({url:a.lmn3+"&do=selectSong",size:"narrow",title:ips.getString("chatbox_selectSong"),forceReload:!0,destructOnClose:!0,callback:function(){t(document).on("click",'[data-action="addSong"]',e.bind(a.addSong,a)),t(document).on("click",'[data-action="removeSong"]',e.bind(a.removeSong,a)),t(document).on("focus",'[data-role="searchSong"]',e.bind(a.focusSongSearch,a)),t(document).on("blur",'[data-role="searchSong"]',e.bind(a.blurSongSearch,a))}}).show(),!1},focusSongSearch:function(t){this.lmn13=setInterval(e.bind(this._checkSongValue,this),700)},blurSongSearch:function(t){clearInterval(this.lmn13)},_checkSongValue:function(){var e=t('[data-role="searchSong"]').val();e!=this.lmn14&&!(e.length<4)&&(this.lmn14=e,this._ajax&&this._ajax.abort&&this._ajax.abort(),this._ajax=ips.getAjax()(this.lmn3+"&do=searchSong",{data:{q:this.lmn14},type:"post"}).done(function(e){t('[data-role="songResults"]').html(e),t(document).trigger("contentChange",[t('[data-role="songResults"]')])}))},addSong:function(e){t(e.currentTarget).closest(".ipsDataItem").attr("data-songID");var n=this;return this._ajax=ips.getAjax()(n.lmn3+"&do=addSong",{data:{song:t(e.currentTarget).closest(".ipsDataItem").attr("data-songID")},type:"post"}).done(function(a){if("error"==a.type)ips.ui.alert.show({message:a.message});else{var o=t(e.currentTarget).closest(".chatboxSongs").find('[data-role="playingSong"]');o.html(a.html),t(document).trigger("contentChange",[o]);var i=a.song;i.id!=n.lmn12&&(n.lmn1.song=i),n.playSong()}}),!1},removeSong:function(e){t(e.currentTarget).closest(".ipsDataItem").attr("data-songID");var n=this;return this._ajax=ips.getAjax()(n.lmn3+"&do=removeSong",{data:{song:t(e.currentTarget).closest(".ipsDataItem").attr("data-songID")},type:"post"}).done(function(a){"error"==a.type?ips.ui.alert.show({message:a.message}):(t(e.currentTarget).closest(".chatboxSongs").find('[data-role="playingSong"]').html(""),n.hideMusicPlayer(),t(".chatBar").trigger("resizeBar"))}),!1},playSong:function(){if(!this.lmn1.song)return!1;var e=t.parseJSON(this.lmn1.song),n=t(".room_"+this.lmn2),a=n.find("#chatbox-player");if(this.lmn12>0&&this.lmn12==e.id)return!1;this.lmn12=e.id,n.find(".chatboxMusicPlayer").removeClass("ipsHide"),t(".chatBar").trigger("resizeBar"),a.jPlayer("stop"),n.find("#current-song-name").html(e.name),n.find("#current-artist-name").html(e.artist),n.find("#topbar-artwork").html('<img src="'+e.thumbnail+'">'),e.file.toLowerCase().indexOf(".mp3")>=0?a.jPlayer("setMedia",{mp3:e.file}).jPlayer("play",1):e.file.toLowerCase().indexOf("m4a")>=0?a.jPlayer("setMedia",{m4a:e.file}).jPlayer("play",1):e.file.toLowerCase().indexOf("wma")>=0&&a.jPlayer("setMedia",{wma:e.file}).jPlayer("play",1)},hideMusicPlayer:function(){this.scope.find("#chatbox-player").jPlayer("stop"),this.scope.find(".chatboxMusicPlayer").addClass("ipsHide"),self.lmn12=0},jPlayer:function(){this.scope.find("#chatbox-player").length&&(this.scope.find("#chatbox-player").jPlayer({cssSelectorAncestor:"#sound-container",swfPath:ips.getSetting("baseURL")+"applications/musicbox/interface/jPlayer",supplied:"mp3,wma,m4a",wmode:"window",volume:ips.utils.db.get("musicbox","volume")?ips.utils.db.get("musicbox","volume"):.5,smoothPlayBar:!0,consoleAlerts:!1,loop:!0}),this.playSong())},resizeWindow:function(){this.scope.closest(".chatBar").length>0&&(this.scope.closest(".chatBar").is(":hidden")?(this.lmn26||this.toggleChat(),this.lmn26=!0):this.lmn26=!1)},goDown:function(){var t=this,e=t.scope.find("#chatContentIframe");t.scope.find("#chatContent"),t.lmn24||e.scrollTop(e.prop("scrollHeight")),t.lmn11||e.find("img").imagesLoaded(function(n){t.lmn24||e.scrollTop(e.prop("scrollHeight"))})},donate:function(e){var n=this,a=ips.ui.dialog.create({url:n.lmn3+"&do=donate",size:"narrow",forceReload:!1,destructOnClose:!0,callback:function(e){t(e).find("form").on("submit",function(e){e.preventDefault();var o=t(e.currentTarget);return ips.getAjax()(o.attr("action"),{data:o.serialize(),type:"post",bypassRedirect:!0}).done(function(t){t.redirect&&(n.lmn29=t.redirect,a.hide(),chatbox.isExternal(n.lmn29)?window.location.href=n.lmn29:n.checkoutDialog(n.lmn29))}).always(function(t){}),!1})}});return a.show(),!1},checkoutDialog:function(e){var n=this,a=ips.ui.dialog.create({url:e,size:"normal",forceReload:!1,destructOnClose:!0,callback:function(e){t(e).find('a[data-action="wizardLink"]').on("click",function(e){return a.hide(),n.checkoutDialog(t(e.currentTarget).attr("href")),!1}),t(e).find("form").on("submit",function(e){e.preventDefault();var o=t(e.currentTarget);return ips.getAjax()(o.attr("action"),{data:o.serialize(),type:"post",bypassRedirect:!0}).done(function(t){var e=t.redirect?t.redirect:n.lmn29;a.hide(),chatbox.isExternal(e)?window.location.href=e:n.checkoutDialog(e)}),!1})}});a.show()}})}(jQuery,_);;$(document).ready(function(){var tabCount=ips.getSetting('chatbox_tabCount');if(tabCount>-1){var chatMenu=$('[data-role="navBarItem"][data-navApp="chatbox"][data-navExt="Chatbox"] > a');if(chatMenu.length>0){chatMenu.append($('<span/>').addClass('ipsNotificationCount chatboxTabCount cbTabCount_'+tabCount).text(tabCount));setInterval(function(){ips.getAjax()(ips.getSetting('baseURL')+'index.php?app=chatbox&module=chatbox&controller=chatbox&do=tabCount').done(function(response){if(self._joined!=1){if(response.count>0){$('.chatboxTabCount').text(response.count).removeClass('cbTabCount_0');}
else $('.chatboxTabCount').text('0').addClass('cbTabCount_0');}});},15000);}}});;ips.templates.set('chatbox.style.superchat'," <li class='ipsDataItem {{#id}}chat_row{{/id}} {{#callme}}mentionMe{{/callme}}' {{#id}}id='{{id}}'{{/id}}>	<div class='superchat' data-amount='{{money}}' style='background: {{mainBg}};'>		<div class='{{#chatterPhoto}}ipsPhotoPanel ipsPhotoPanel_tiny{{/chatterPhoto}} ipsClearfix'>			<a href='#' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}' data-ipsHover-onClick{{/memberHovercard}} class='ipsUserPhoto ipsUserPhoto_tiny' id='ips_uid_{{chatterID}}'>				<img src='{{chatterPhoto}}' alt=''>			</a>			<div>				<a href='#' class='chatterName' style='color: #{{mainTxt}};' data-action='mention' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}'{{/memberHovercard}}>					{{{chatterNameFormat}}}				</a>				<div class='ipsPos_right' style='color: #{{mainTxt}};'>					<time class='cbTime {{#inDay}}timeago{{/inDay}} ipsType_small ipsType_light' datetime='{{time}}'>{{time}}</time>&nbsp;					{{#id}}						{{#canManageMSG}}							<a class='msgAction' href='#msgAction{{id}}_menu' id='msgAction{{id}}' data-action='options' data-ipsMenu data-ipsMenu-closeOnClick='false' data-ipsMenu-appendTo='.chatboxContainer'>								<i class='fa fa-ellipsis-h'></i>							</a>							<ul class='cbMsgActionMenu ipsMenu ipsMenu_auto ipsHide' id='msgAction{{id}}_menu'>								{{#canEdit}}<li class='ipsMenu_item'><a href='#' data-action='edit' data-chatID='{{id}}'>{{#lang}}chatbox_edit{{/lang}}</a></li>{{/canEdit}}								{{#canDelete}}<li class='ipsMenu_item'><a href='#' data-action='delete' data-chatID='{{id}}'>{{#lang}}chatbox_delete{{/lang}}</a></li>{{/canDelete}}								{{#canReport}}<li class='ipsMenu_item'><a href='#' data-action='report' data-chatID='{{id}}'>{{#lang}}chatbox_report{{/lang}}</a></li>{{/canReport}}								{{#canBeBlocked}}<li class='ipsMenu_item'><a href='#' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}'>{{#lang}}chatbox_block{{/lang}}</a></li>{{/canBeBlocked}}							</ul>						{{/canManageMSG}}					{{/id}}				</div>				<div class='ipsList_inline'><span class='money' style='color: #{{mainTxt}};'>{{money}}</span></div>			</div>		</div>		<div id='chatRow_{{id}}' data-id='{{id}}' class='msgArea' style='color: #{{mainTxt}}; background-color: {{subBg}}'><span class='chatbox_msg'>{{{content}}}</span></div>	</div></li>");ips.templates.set('chatbox.style.standard'," <li class='ipsDataItem {{#id}}chat_row{{/id}} chatbox_style1 {{#callme}}mentionMe{{/callme}}' {{#id}}id='{{id}}'{{/id}}>	<div class='ipsPadding:half {{#chatterPhoto}}ipsPhotoPanel ipsPhotoPanel_tiny{{/chatterPhoto}} ipsClearfix'>		<a href='#' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}' data-ipsHover-onClick{{/memberHovercard}} class='ipsUserPhoto ipsUserPhoto_tiny' id='ips_uid_{{chatterID}}'>			<img src='{{chatterPhoto}}' alt=''>		</a>		<div>			<a href='#' class='chatterName' data-action='mention' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}'{{/memberHovercard}}>{{{chatterNameFormat}}}</a>			<div class='ipsPos_right'>				<time class='cbTime {{#inDay}}timeago{{/inDay}} ipsType_small ipsType_light' datetime='{{time}}'>{{time}}</time>&nbsp;				{{#id}}					{{#canManageMSG}}						<a class='msgAction' href='#msgAction{{id}}_menu' id='msgAction{{id}}' data-action='options' data-ipsMenu data-ipsMenu-closeOnClick='false' data-ipsMenu-appendTo='.chatboxContainer'>							<i class='fa fa-ellipsis-h'></i>						</a>						<ul class='cbMsgActionMenu ipsMenu ipsMenu_auto ipsHide' id='msgAction{{id}}_menu'>							{{#canEdit}}<li class='ipsMenu_item'><a href='#' data-action='edit' data-chatID='{{id}}'>{{#lang}}chatbox_edit{{/lang}}</a></li>{{/canEdit}}							{{#canDelete}}<li class='ipsMenu_item'><a href='#' data-action='delete' data-chatID='{{id}}'>{{#lang}}chatbox_delete{{/lang}}</a></li>{{/canDelete}}							{{#canReport}}<li class='ipsMenu_item'><a href='#' data-action='report' data-chatID='{{id}}'>{{#lang}}chatbox_report{{/lang}}</a></li>{{/canReport}}							{{#canBeBlocked}}<li class='ipsMenu_item'><a href='#' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}'>{{#lang}}chatbox_block{{/lang}}</a></li>{{/canBeBlocked}}						</ul>					{{/canManageMSG}}				{{/id}}			</div>			<div class='ipsList_inline' id='chatRow_{{id}}' data-id='{{id}}'><span class='chatbox_msg'>{{{content}}}</span></div>		</div>	</div></li>");ips.templates.set('chatbox.style.condensed'," <li class='ipsDataItem {{#id}}chat_row{{/id}} chatbox_style2 {{#callme}}mentionMe{{/callme}}' {{#id}}id='{{id}}'{{/id}}>	<div class='ipsPadding:half ipsClearfix'>		<a href='#' class='chatterName' data-action='mention' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}'>{{{chatterNameFormat}}}</a>:  		<span class='ipsPos_right'>			<time class='cbTime {{#inDay}}timeago{{/inDay}} ipsType_small ipsType_light' datetime='{{time}}'>{{time}}</time>&nbsp;			{{#id}}				{{#canManageMSG}}					<a class='msgAction' href='#msgAction{{id}}_menu' id='msgAction{{id}}' data-action='options' data-ipsMenu data-ipsMenu-closeOnClick='false' data-ipsMenu-appendTo='.chatboxContainer'>						<i class='fa fa-ellipsis-h'></i>					</a>					<ul class='cbMsgActionMenu ipsMenu ipsMenu_auto ipsHide' id='msgAction{{id}}_menu'>						{{#canEdit}}<li class='ipsMenu_item'><a href='#' data-action='edit' data-chatID='{{id}}'>{{#lang}}chatbox_edit{{/lang}}</a></li>{{/canEdit}}						{{#canDelete}}<li class='ipsMenu_item'><a href='#' data-action='delete' data-chatID='{{id}}'>{{#lang}}chatbox_delete{{/lang}}</a></li>{{/canDelete}}						{{#canReport}}<li class='ipsMenu_item'><a href='#' data-action='report' data-chatID='{{id}}'>{{#lang}}chatbox_report{{/lang}}</a></li>{{/canReport}}						{{#canBeBlocked}}<li class='ipsMenu_item'><a href='#' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}'>{{#lang}}chatbox_block{{/lang}}</a></li>{{/canBeBlocked}}					</ul>				{{/canManageMSG}}			{{/id}}		</span>		<span id='chatRow_{{id}}' data-id='{{id}}'><span class='chatbox_msg'>{{{content}}}</span></span>	</div></li>");ips.templates.set('chatbox.style.bubbles'," <li class='ipsDataItem {{#id}}chat_row{{/id}} chatbox_style3 {{#callme}}mentionMe{{/callme}}' {{#id}}id='{{id}}'{{/id}}>	<div class='ipsPadding:half {{#chatterPhoto}}ipsPhotoPanel ipsPhotoPanel_tiny{{/chatterPhoto}} ipsClearfix'>		<a href='#' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}' data-ipsHover-onClick{{/memberHovercard}} class='ipsUserPhoto ipsUserPhoto_tiny' id='ips_uid_{{chatterID}}'>			<img src='{{chatterPhoto}}' alt=''>		</a>		<div class='ipsClearfix'>			<div class='bubble cb1' id='chatRow_{{id}}' data-id='{{id}}'>				<a href='#' class='chatterName ipsType_reset' data-action='mention' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}'{{/memberHovercard}}>{{{chatterNameFormat}}}:</a> 				<span class='chatbox_msg'>{{{content}}}</span>			</div>			<br>			<span class='ipsPos_right'>				<time class='cbTime {{#inDay}}timeago{{/inDay}} ipsType_small ipsType_light' datetime='{{time}}'>{{time}}</time>&nbsp;				{{#id}}					{{#canManageMSG}}						<a class='msgAction' href='#msgAction{{id}}_menu' id='msgAction{{id}}' data-action='options' data-ipsMenu data-ipsMenu-closeOnClick='false' data-ipsMenu-appendTo='.chatboxContainer'>							<i class='fa fa-ellipsis-h'></i>						</a>						<ul class='cbMsgActionMenu ipsMenu ipsMenu_auto ipsHide' id='msgAction{{id}}_menu'>							{{#canEdit}}<li class='ipsMenu_item'><a href='#' data-action='edit' data-chatID='{{id}}'>{{#lang}}chatbox_edit{{/lang}}</a></li>{{/canEdit}}							{{#canDelete}}<li class='ipsMenu_item'><a href='#' data-action='delete' data-chatID='{{id}}'>{{#lang}}chatbox_delete{{/lang}}</a></li>{{/canDelete}}							{{#canReport}}<li class='ipsMenu_item'><a href='#' data-action='report' data-chatID='{{id}}'>{{#lang}}chatbox_report{{/lang}}</a></li>{{/canReport}}							{{#canBeBlocked}}<li class='ipsMenu_item'><a href='#' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}'>{{#lang}}chatbox_block{{/lang}}</a></li>{{/canBeBlocked}}						</ul>					{{/canManageMSG}}				{{/id}}			</span>		</div>	</div></li>");ips.templates.set('chatbox.style.talkie'," <li class='{{#id}}chat_row{{/id}} chatbox_style4 {{#callme}}mentionMe{{/callme}}' {{#id}}id='{{id}}'{{/id}}>	{{^isMe}}		<div class='ipsPadding:half {{#chatterPhoto}}ipsPhotoPanel ipsPhotoPanel_tiny{{/chatterPhoto}} ipsClearfix'>			<a href='#' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}' data-ipsHover-onClick{{/memberHovercard}} class='ipsUserPhoto ipsUserPhoto_tiny' id='ips_uid_{{chatterID}}'>				<img src='{{chatterPhoto}}' alt=''>			</a>			<div class='ipsClearfix'>				<div class='talkie bubbleHim' id='chatRow_{{id}}' data-id='{{id}}'>					<a href='#' class='chatterName ipsType_reset' data-action='mention' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}'{{/memberHovercard}}>{{{chatterNameFormat}}}:</a>					<span class='chatbox_msg'>{{{content}}}</span>				</div>			</div>			<div class='msgInfo'>				<time class='cbTime {{#inDay}}timeago{{/inDay}} ipsType_small ipsType_light' datetime='{{time}}'>{{time}}</time>&nbsp;				{{#id}}					{{#canManageMSG}}						<a class='msgAction' href='#msgAction{{id}}_menu' id='msgAction{{id}}' data-action='options' data-ipsMenu data-ipsMenu-closeOnClick='false' data-ipsMenu-appendTo='.chatboxContainer'>							<i class='fa fa-ellipsis-h'></i>						</a>						<ul class='cbMsgActionMenu ipsMenu ipsMenu_auto ipsHide' id='msgAction{{id}}_menu'>							{{#canEdit}}<li class='ipsMenu_item'><a href='#' data-action='edit' data-chatID='{{id}}'>{{#lang}}chatbox_edit{{/lang}}</a></li>{{/canEdit}}							{{#canDelete}}<li class='ipsMenu_item'><a href='#' data-action='delete' data-chatID='{{id}}'>{{#lang}}chatbox_delete{{/lang}}</a></li>{{/canDelete}}							{{#canReport}}<li class='ipsMenu_item'><a href='#' data-action='report' data-chatID='{{id}}'>{{#lang}}chatbox_report{{/lang}}</a></li>{{/canReport}}							{{#canBeBlocked}}<li class='ipsMenu_item'><a href='#' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}'>{{#lang}}chatbox_block{{/lang}}</a></li>{{/canBeBlocked}}						</ul>					{{/canManageMSG}}				{{/id}}			</span>		</div>	{{/isMe}}	{{#isMe}}		<div class='ipsPadding:half ipsClearfix'>			<div class='ipsClearfix'>				<div class='talkie bubbleMe' id='chatRow_{{id}}' data-id='{{id}}'>					<span class='chatbox_msg'>{{{content}}}</span>				</div>			</div>			<div class='msgInfo ipsType_right'>				<time class='cbTime {{#inDay}}timeago{{/inDay}} ipsType_small ipsType_light' datetime='{{time}}'>{{time}}</time>&nbsp;				{{#id}}					{{#canManageMSG}}						<a class='msgAction' href='#msgAction{{id}}_menu' id='msgAction{{id}}' data-action='options' data-ipsMenu data-ipsMenu-closeOnClick='false' data-ipsMenu-appendTo='.chatboxContainer'>							<i class='fa fa-ellipsis-h'></i>						</a>						<ul class='cbMsgActionMenu ipsMenu ipsMenu_auto ipsHide' id='msgAction{{id}}_menu'>							{{#canEdit}}<li class='ipsMenu_item'><a href='#' data-action='edit' data-chatID='{{id}}'>{{#lang}}chatbox_edit{{/lang}}</a></li>{{/canEdit}}							{{#canDelete}}<li class='ipsMenu_item'><a href='#' data-action='delete' data-chatID='{{id}}'>{{#lang}}chatbox_delete{{/lang}}</a></li>{{/canDelete}}							{{#canReport}}<li class='ipsMenu_item'><a href='#' data-action='report' data-chatID='{{id}}'>{{#lang}}chatbox_report{{/lang}}</a></li>{{/canReport}}							{{#canBeBlocked}}<li class='ipsMenu_item'><a href='#' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}'>{{#lang}}chatbox_block{{/lang}}</a></li>{{/canBeBlocked}}						</ul>					{{/canManageMSG}}				{{/id}}			</div>		</div>	{{/isMe}}</li>");ips.templates.set('chatbox.style.room.system'," <li class='ipsDataItem {{#id}}chat_row{{/id}} system_chat' {{#id}}id='{{id}}'{{/id}}>	<div class='ipsPadding:half ipsClearfix'>		<span class='chatbox_msg ipsType_light' id='chatRow_{{id}}' {{#id}}id='{{id}}'{{/id}}><i class='fa fa-angle-double-right'></i> {{{content}}}</span>		<span class='ipsPos_right'>			<time class='cbTime {{#inDay}}timeago{{/inDay}} ipsType_small ipsType_light' datetime='{{time}}'>{{time}}</time>&nbsp;			{{#canDelete}}				{{#canDelete}}					<a class='msgAction' href='#msgAction{{id}}_menu' id='msgAction{{id}}' data-action='options' data-ipsMenu data-ipsMenu-closeOnClick='false' data-ipsMenu-appendTo='.chatboxContainer'>						<i class='fa fa-ellipsis-h'></i>					</a>					<ul class='cbMsgActionMenu ipsMenu ipsMenu_auto ipsHide' id='msgAction{{id}}_menu'>						{{#canDelete}}<li class='ipsMenu_item'><a href='#' data-action='delete' data-chatID='{{id}}'>{{#lang}}chatbox_delete{{/lang}}</a></li>{{/canDelete}}					</ul>				{{/canDelete}}			{{/canDelete}}		</span>	</div></li>");ips.templates.set('chatbox.style.con.system'," <li class='ipsDataItem {{#id}}chat_row{{/id}} system_chat' {{#id}}id='{{id}}'{{/id}}>	<div class='ipsPadding:half ipsClearfix'>		<span class='chatbox_msg ipsType_light ipsType_small' id='chatRow_{{id}}' {{#id}}id='{{id}}'{{/id}}>			<i class='fa fa-angle-double-right'></i> {{{content}}}		</span>		<span class='ipsPos_right'>			{{#canDelete}}				<a class='msgAction' href='#msgAction{{id}}_menu' id='msgAction{{id}}' data-action='options' data-ipsMenu data-ipsMenu-closeOnClick='false' data-ipsMenu-appendTo='.chatboxContainer'>					<i class='fa fa-ellipsis-h'></i>				</a>				<ul class='cbMsgActionMenu ipsMenu ipsMenu_auto ipsHide' id='msgAction{{id}}_menu'>					{{#canDelete}}<li class='ipsMenu_item'><a href='#' data-action='delete' data-chatID='{{id}}'>{{#lang}}chatbox_delete{{/lang}}</a></li>{{/canDelete}}				</ul>			{{/canDelete}}		</span>	</div></li>");ips.templates.set('chatbox.disconnected'," <div class='disconnected'>	<span>		<i class='fa fa-exclamation-triangle'></i><br>		{{msg}}<br>		{{#btn}}			<a href='#' id='btnConnect' class='ipsButton ipsButton_primary ipsButton_verySmall ipsMargin_top:half' data-action='connect'>{{btn}}</a>		{{/btn}}	</span></div>");ips.templates.set('chatbox.chatters.list'," <ul class='ipsMenu ipsMenu_normal menuChatters' id='chattersList_{{roomID}}_menu' style='display: none'>	<li class='ipsMenu_title'>{{#lang}}chatbox_online_users{{/lang}}</li>	<div class='ipsMenu_innerContent chatters_content'>		<div class='ipsLoading chatbox_chatters_Panel'>			<ul class='ipsDataList'></ul>		</div>	</div></ul>");ips.templates.set('chatbox.chatter.row'," <li class='ipsDataItem chatter_row'>	<div class='ipsPadding:half ipsPhotoPanel ipsPhotoPanel_tiny ipsClearfix'>		<a href='#' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}' data-ipsHover-onClick{{/memberHovercard}} class='ipsUserPhoto ipsUserPhoto_tiny' id='ips_uid_{{chatterID}}'>			<img src='{{chatterPhoto}}' alt=''>		</a>		<div class='nameInList ipsClearfix'>			<a href='#' class='username' data-action='mention' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}'{{/memberHovercard}}>				{{#is_anon}}<span class='cb_isAnon ipsType_light' data-ipsTooltip title='{{#lang}}chatbox_is_anon{{/lang}}'><i class='fa fa-eye-slash'></i></span>&nbsp;{{/is_anon}}				{{{chatterNameFormat}}}			</a>			<div class='ipsList_inline'>				{{#privateChat}}					<span data-controller='bim.chatbox.startChat'>						<a href='#' class='ipsButton ipsButton_positive ipsButton_verySmall' data-action='startChat' data-memberID='{{chatterID}}'>							<i class='fa fa-comment'></i> {{#lang}}chatbox_send_private{{/lang}}						</a>&nbsp;					</span>				{{/privateChat}}				{{#canBeBlocked}}					<a href='#' class='ipsButton ipsButton_negative ipsButton_verySmall' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}'>						<i class='fa fa-ban'></i> {{#lang}}chatbox_block{{/lang}}					</a>				{{/canBeBlocked}}			</div>		</div>	</div></li>");ips.templates.set('chatbox.parseImage'," <a href='{{url}}' class='mitem' data-action='zoomImage'>	{{#blankImage}}		<img src='{{blankImage}}' data-src='{{url}}' class='lazyload'>	{{/blankImage}}	{{^blankImage}}		<img src='{{url}}'>	{{/blankImage}}</a>");ips.templates.set('chatbox.parseURL',"<a href='{{url}}' target='_blank' class='chatboxURL' rel='noopener noreferrer'>{{text}}</a>");ips.templates.set('chatbox.parseVideo'," <div class='chatboxVideoContainer mitem' data-source='{{source}}' data-url='{{url}}' data-play='{{play}}' data-id='{{id}}' data-img='{{img}}' data-html5='{{html5}}'>	<div class='chatboxVideo {{#isShorts}}youtubeShorts{{/isShorts}}'>		{{#img}}			{{#blankImage}}				<img src='{{blankImage}}' data-src='{{img}}' class='lazyload'>			{{/blankImage}}			{{^blankImage}}				<img src='{{img}}'>			{{/blankImage}}			<a href='#' data-action='playVideoInIframe'></a>		{{/img}}		{{^img}}			{{#html5}}				<video class='chatboxPlayer' width='100%' height='100%' controls>					<source src='{{play}}' autostart='false'>				</video>			{{/html5}}			{{^html5}}				<iframe class='chatboxPlayer' width='100%' height='100%' src='{{play}}' frameborder='0' allow='autoplay; encrypted-media' allowfullscreen></iframe>			{{/html5}}		{{/img}}	</div>	<a class='chatboxVideoPopupOpen' data-action='playVideoInPopup'>		<i class='fa fa-window-maximize' aria-hidden='true'></i>&nbsp;&nbsp;{{#lang}}chatbox_expandPlayer{{/lang}}	</a></div>");ips.templates.set('chatbox.videoIframe'," 	{{#html5}}		<video class='chatboxPlayer' width='100%' height='100%' controls>			<source src='{{play}}'>		</video>	{{/html5}}	{{^html5}}		<iframe class='chatboxPlayer' width='100%' height='100%' src='{{play}}' frameborder='0' allow='autoplay; encrypted-media' allowfullscreen></iframe>	{{/html5}}");ips.templates.set('chatbox.videoPopup'," <div class='chatboxVideoWrapper videopopup_{{chatID}}'>	<iframe width='560' height='315' src='{{play}}' frameborder='0' allow='autoplay; encrypted-media' allowfullscreen></iframe></div>");ips.templates.set('chatbox.parseAudio'," <div class='chatboxVideoContainer mitem'>	<audio {{#isMemo}}class='cbVoiceMsg'{{/isMemo}} src='{{url}}' controls></audio></div>");ips.templates.set('chatbox.parseGiphy'," <div class='bimGiphyContainer mitem'>	<div class='giphy'>	{{#blankImage}}		<a href='{{gif}}' data-ipslightbox><img class='ipsImage bimGiphyIMG' src='{{blankImage}}' data-src='{{still}}' class='lazyload'></a>	{{/blankImage}}	{{^blankImage}}		<a href='{{gif}}' data-ipslightbox><img class='ipsImage bimGiphyIMG' src='{{still}}'></a>	{{/blankImage}}	<div class='giphyPlayBtn'></div>	</div></div>");ips.templates.set('chatbox.editInput'," <textarea type='text' class='editChatInput' data-action='doEdit' autocomplete='off'></textarea>");ips.templates.set('chatbox.loadMore'," <li id='loadMore' class='ipsDataItem ipsType_center ipsPadding'><span class='ipsLoading ipsLoading_tiny'></span></li>");ips.templates.set('chatbox.loadMoreBtn'," <li id='loadMoreBtn' class='ipsDataItem ipsType_center ipsCursor_pointer ipsAreaBackground_light' data-action='loadMore'>	{{#lang}}chatbox_loadMoreBtn{{/lang}}</li>");ips.templates.set('chatbox.convo.list.rooms'," <li class='ipsDataItem rooms ipsPadding:half ipsClearfix ipsCursor_pointer' data-action='openRoom' data-roomID='{{id}}'>	<a href='#' class='ipsPos_left ipsType_blendLinks' title='{{title}}'>		<i class='fa fa-{{icon}}'></i> {{title}}	</a>	{{#users}}<span class='ipsPos_right ipsBadge ipsBadge_positive'>{{users}}</span>{{/users}}</li>");ips.templates.set('chatbox.blankRoom'," <div class='room_{{roomID}}'></div>");ips.templates.set('chatbox.blankCon'," <div class='convo_{{conID}}'></div>");ips.templates.set('chatbox.newcon.chats'," <li class='ipsDataItem convoRow ipsClearfix ipsCursor_pointer {{#unread}}mentionMe{{/unread}} convoRow_{{id}}' data-action='openConversation' data-conID='{{id}}'>	<div class='{{^isGroup}}ipsPhotoPanel ipsPhotoPanel_tiny{{/isGroup}}'>		{{#isGroup}}			{{{icon}}}		{{/isGroup}}		{{^isGroup}}			<span class='chatbox_one_avatar'>				<i class='fa fa-circle ipsOnlineStatus_online {{^isOnline}}ipsHide{{/isOnline}}'></i>				<span class='ipsUserPhoto ipsUserPhoto_tiny'><img src='{{icon}}'></span>			</span>		{{/isGroup}}		<div class='ipsClearfix convoRowMain'>			<span class='ipsPos_left conRowName' title='{{{name}}}'>				<b>{{{name}}}</b> <span class='newMsgCountTxt'>{{#unread}}({{unread}}){{/unread}}</span>			</span>			<time class='cbTime {{#inDay}}timeago{{/inDay}} ipsPos_right ipsType_small ipsType_light' datetime='{{lastMsgTime}}'>{{lastMsgTime}}</time>&nbsp;			{{#lastMsg}}<br><div class='cbLastMSG ipsType_light'>{{lastMsg}}</div>{{/lastMsg}}		</div>	</div></li>");ips.templates.set('chatbox.newcon.temp'," <li class='convoRow tempCon ipsClearfix ipsCursor_pointer convoRow_{{id}}' data-action='openConversation' data-conID='{{id}}'></li>");ips.templates.set('chatbox.newcon.mem'," <li class='convoRow ipsClearfix ipsCursor_pointer' {{^isBan}}data-action='openConversation' data-memberID='{{id}}' data-conID='{{conID}}'{{/isBan}}>	<div class='ipsPhotoPanel ipsPhotoPanel_tiny'>		<span class='chatbox_one_avatar'>			<i class='fa fa-circle ipsOnlineStatus_online cbMemOnline {{^isOnline}}ipsHide{{/isOnline}}'></i>			<span class='ipsUserPhoto ipsUserPhoto_tiny'><img src='{{photo}}'></span>		</span>		<div>			<strong>{{{name}}}</strong><br>			<span class='ipsType_light'>{{{extra}}}</span>		</div>	</div></li>");ips.templates.set('chatbox.search.mem'," 	<li class='ipsAutocompleteMenu_item ipsClearfix' data-value=\"{{value}}\" role='option' role='listitem'>		<div class='ipsPhotoPanel ipsPhotoPanel_tiny'>			<span class='chatbox_one_avatar'>				<i class='fa fa-circle ipsOnlineStatus_online cbMemOnline {{^isOnline}}ipsHide{{/isOnline}}'></i>				<span class='ipsUserPhoto ipsUserPhoto_tiny'><img src='{{photo}}'></span>			</span>			<div>				<strong>{{{name}}}</strong><br>				<span class='ipsType_light'>{{{extra}}}</span>			</div>		</div>	</li>");ips.templates.set('chatbox.newcon.notify'," <div data-role='newNotification'>	<div class='ipsPhotoPanel ipsPhotoPanel_tiny' data-conID='{{{id}}}'>		<span class='ipsUserPhoto ipsUserPhoto_tiny'><img src='{{{icon}}}'></span>		<div class='ipsClearfix'>			<span class='ipsPos_left'><b>{{{title}}}</b></span>			{{#time}}<span class='ipsPos_right ipsType_light ipsType_small'>{{time}}</span>{{/time}}			{{#lastMsg}}<br><span class='cbLastMSG ipsType_small'>{{{lastMsg}}}</span>{{/lastMsg}}		</div>	</div></div>");ips.templates.set('chatbox.upload.file'," 	<div class='cbUploadedIMG ipsAttach ipsImageAttach' id='{{id}}' data-role='file' data-fileid='{{id}}' data-fullsizeurl='{{imagesrc}}' data-thumbnailurl='{{thumbnail}}' data-fileType='image'>		<ul class='ipsList_inline ipsImageAttach_controls'>			<li class='ipsPos_right' data-role='deleteFileWrapper'>				<input type='hidden' name='{{field_name}}_keep[{{id}}]' value='1'>				<a href='#' data-role='deleteFile' class='ipsButton ipsButton_verySmall ipsButton_light' data-ipsTooltip title='{{#lang}}removeScreenshot{{/lang}}'><i class='fa fa-times'></i></a>			</li>		</ul>		<label for='{{field_name}}_primary_screenshot_{{id}}' class='ipsCursor_pointer'>			<div class='ipsImageAttach_thumb ipsType_center' data-role='preview' data-grid-ratio='65' {{#thumb}}style='background-image: url( {{thumbnail_for_css}} )'{{/thumb}}>				{{#status}}					<span class='ipsImageAttach_status ipsType_light' data-role='status'>{{{status}}}</span>					<span class='ipsAttachment_progress'><span data-role='progressbar'></span></span>				{{/status}}				{{#thumb}}					{{{thumb}}}				{{/thumb}}				<i class='fa fa-music ipsType_large musicType' {{#thumb}}style='display: none'{{/thumb}}></i>			</div>		</label>	</div>");ips.templates.set('chatbox.upload.fileWrapper'," 	<div>{{{content}}}</div>");ips.templates.set('chatbox.emoticons'," <div class='ipsMenu ipsMenu_wide' id='{{id}}_menu' style='display: none' data-editorID='{{editor}}' data-controller='chatbox.emoticons'>	<div class='ipsMenu_headerBar'>		<p class='ipsType_reset ipsPos_right'>			<a href='#' class='ipsType_blendLinks ipsHide' data-role='categoryTrigger' data-ipsMenu data-ipsMenu-appendTo='#{{id}}_menu' id='{{id}}_more'>{{#lang}}emoticonCategories{{/lang}} <i class='fa fa-caret-down'></i></a>		</p>		<h4 class='ipsType_sectionHead'>{{#lang}}emoji{{/lang}}</h4>		<ul data-role='categoryMenu' class='ipsMenu ipsMenu_auto ipsCursor_pointer' id='{{id}}_more_menu' role='menu' style='display: none'>		</ul>	</div>	<div class='ipsMenu_innerContent ipsEmoticons_content'>		<div class='ipsEmpty ipsType_center ipsEmoticons_contentLoading' data-role='emojiLoading'>			{{#lang}}loading{{/lang}}...		</div>	</div>	<div class='ipsMenu_footerBar ipsHide'>		<input type='text' data-role='emoticonSearch' class='ipsField_fullWidth' placeholder='{{#lang}}emoticonFind{{/lang}}'>	</div></div>");;